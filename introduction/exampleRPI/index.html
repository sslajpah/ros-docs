<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Sebastjan Slajpah" /><link rel="canonical" href="https://sslajpah.github.io/ros-docs/introduction/exampleRPI/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Examples for RPi4 - ROS DOCS</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Examples for RPi4";
        var mkdocs_page_input_path = "introduction/exampleRPI.md";
        var mkdocs_page_url = "/ros-docs/introduction/exampleRPI/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> ROS DOCS
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Introduction to ROS</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../">About ROS</a>
    <ul>
    <li class="toctree-l2"><a class="reference internal" href="../#why-ros">Why ROS?</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="../#ros-filesystem-level">ROS Filesystem Level</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="../#ros-computation-graph-level">ROS Computation Graph Level</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="../#ros-community-level">ROS Community Level</a>
    </li>
        </ul>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../setup/">ROS setup</a>
    <ul>
    <li class="toctree-l2"><a class="reference internal" href="../setup/#roscore">roscore</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="../setup/#catkin-workspace">catkin workspace</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../packages/">Packages</a>
    <ul>
    <li class="toctree-l2"><a class="reference internal" href="../packages/#new-package">New package</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../nodes/">Node</a>
    <ul>
    <li class="toctree-l2"><a class="reference internal" href="../nodes/#new-node">New node</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="../nodes/#new-node-class">New node - class</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="../nodes/#debug">DEBUG</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Examples for RPi4</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#roscore">roscore</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#catkin-workspace">catkin workspace</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../topics/">Topics</a>
    <ul>
    <li class="toctree-l2"><a class="reference internal" href="../topics/#example">Example</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="../topics/#publisher">Publisher</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="../topics/#subscriber">Subscriber</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="../topics/#debug">DEBUG</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="../topics/#exercise">Exercise</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../launch/">Launch file</a>
    <ul>
    <li class="toctree-l2"><a class="reference internal" href="../launch/#new-launch">New .launch</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../network/">ROS Network</a>
    <ul>
    <li class="toctree-l2"><a class="reference internal" href="../network/#connection">Connection</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="../network/#ros_master_uri">ROS_MASTER_URI</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="../network/#test-connection">Test connection</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="../network/#exercise">Exercise</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../services/">Service</a>
    <ul>
    <li class="toctree-l2"><a class="reference internal" href="../services/#example">Example</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="../services/#server">Server</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="../services/#client">Client</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="../services/#debug">DEBUG</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="../services/#exercise">Exercise</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../msg/">Custom messages</a>
    <ul>
    <li class="toctree-l2"><a class="reference internal" href="../msg/#msg">MSG</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="../msg/#srv">SRV</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="../msg/#use-of-custom-msg-and-srv">Use of custom MSG and SRV</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="../msg/#debug">DEBUG</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="../msg/#exercise">Exercise</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../actions/">Action</a>
    <ul>
    <li class="toctree-l2"><a class="reference internal" href="../actions/#action-msg">Action MSG</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="../actions/#example">Example</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="../actions/#action-server">Action server</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="../actions/#action-client">Action client</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="../actions/#exercise">Exercise</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../parameters/">Parameters</a>
    <ul>
    <li class="toctree-l2"><a class="reference internal" href="../parameters/#example">Example</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="../parameters/#debug">DEBUG</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="../parameters/#exercise">Exercise</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../debug/">Debug tools</a>
    <ul>
    <li class="toctree-l2"><a class="reference internal" href="../debug/#logging">Logging</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="../debug/#rqt_console">rqt_console</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="../debug/#rqt_plot">rqt_plot</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="../debug/#rqt_graph">rqt_graph</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="../debug/#rviz">RViz</a>
    </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Examples</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../examples/dirkin/">DirKin</a>
    <ul>
    <li class="toctree-l2"><a class="reference internal" href="../../examples/dirkin/#code">Code</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../examples/robot/">Robot control</a>
    <ul>
    <li class="toctree-l2"><a class="reference internal" href="../../examples/robot/#code">Code</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../examples/mobile/">Mobile robot control</a>
    <ul>
    <li class="toctree-l2"><a class="reference internal" href="../../examples/mobile/#code">Code</a>
    </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Cameras</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../kamera/logitech_C920/">Aruco markers</a>
    <ul>
    <li class="toctree-l2"><a class="reference internal" href="../../kamera/logitech_C920/#usb_cam-driver">usb_cam driver</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="../../kamera/logitech_C920/#calibration">Calibration</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="../../kamera/logitech_C920/#aruco-markers">Aruco markers</a>
    </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Dodatno</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../additional/">ROS na RaspberryPi4</a>
    <ul>
    <li class="toctree-l2"><a class="reference internal" href="../../additional/#namestitev-ubuntu-1804-server">Namestitev Ubuntu 18.04 Server</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="../../additional/#namestitev-ros">Namestitev ROS</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="../../additional/#nastavitev-staticnega-ip">Nastavitev statiƒçnega IP</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="../../additional/#povezava-s-ssh">Povezava s SSH</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="../../additional/#povezava-z-vs-code">Povezava z VS Code</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="../../additional/#gpio-na-raspberrypi">GPIO na RaspberryPi</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../additional/sick/">Sick NanoScan3</a>
    <ul>
    <li class="toctree-l2"><a class="reference internal" href="../../additional/sick/#install-ros-support">Install ROS support</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="../../additional/sick/#run-the-driver">Run the driver</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="../../additional/sick/#published-topics">Published topics</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../additional/linux/">Linux ukazi</a>
    <ul>
    </ul>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">ROS DOCS</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Introduction to ROS</li>
      <li class="breadcrumb-item active">Examples for RPi4</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/sslajpah/ros-docs/edit/master/docs/introduction/exampleRPI.md">Edit on sslajpah/ros-docs</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="ros-setup">ROS setup</h1>
<h2 id="roscore">roscore</h2>
<ul>
<li>takes care of communicaiton between different ROS functionalities</li>
<li>it can run only one at once</li>
<li>connects different ROS system into one ROS network</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">roscore</span>
</code></pre></div>
<h2 id="catkin-workspace">catkin workspace</h2>
<p>CATKIN is an official build system for ROS</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>cd
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>mkdir catkin_ws
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>cd catkin_ws
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>mkdir src
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>catkin_make
</code></pre></div>
<p>Alternative is to use <code>catkin build</code> (beforehand you need to remove devel and build folders).</p>
<p>Conect console with ROS variables
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>cd devel
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>source setup.bash
</code></pre></div></p>
<p>To do this automatically when the console is opened, add to <code>bashrc.sh</code>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>echo &quot;source ~/catkin_ws/devel/setup.bash&quot; &gt;&gt; ~/.bashrc
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>source ~/.bashrc
</code></pre></div></p>
<h1 id="packages">Packages</h1>
<p>Packages are independent units, that can be re-used.</p>
<h2 id="new-package">New package</h2>
<p>Go to <code>catkin_ws/src/</code> folder.</p>
<p>Basic syntax:
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>catkin_create_pkg &lt;package_name&gt; [depend1] [depend2] [depend3]
</code></pre></div></p>
<p>Create new package <code>rpi_test</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>cd ~/catkin_ws/src
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>catkin_create_pkg rpi_test rospy std_msgs
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>cd ..
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>catkin_make
</code></pre></div>
<h1 id="node">Node</h1>
<p>Nodes are processes:</p>
<ul>
<li>used for calculations,</li>
<li>that run inside robotic application,</li>
<li>grouped into packages,</li>
<li>that communicate with each other (topics, servers, actions, parameter servers). </li>
</ul>
<p>Why to use nodes:</p>
<ul>
<li>reduce code complexity,</li>
<li>the code is more error-resistant,</li>
<li>use of different programming languages.</li>
</ul>
<h2 id="new-node">New node</h2>
<p>Nodes are scripts that are located inside <code>scripts</code> folder.
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>roscd rpi_test
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>mkdir scripts
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>cd scripts
</code></pre></div>
Create new script <code>my_first_node.py</code>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>touch my_first_node.py
</code></pre></div></p>
<p>Change the access permissions of the file to executable:
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>chmod +x my_first_node.py
</code></pre></div></p>
<p>Open script with Visual Studio Code:
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>code my_first_node.py
</code></pre></div></p>
<p>The minimal working example for node:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">my_fist_node.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1">1</a></span>
<span class="normal"><a href="#__codelineno-10-2">2</a></span>
<span class="normal"><a href="#__codelineno-10-3">3</a></span>
<span class="normal"><a href="#__codelineno-10-4">4</a></span>
<span class="normal"><a href="#__codelineno-10-5">5</a></span>
<span class="normal"><a href="#__codelineno-10-6">6</a></span>
<span class="normal"><a href="#__codelineno-10-7">7</a></span>
<span class="normal"><a href="#__codelineno-10-8">8</a></span>
<span class="normal"><a href="#__codelineno-10-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="ch">#!/usr/bin/env python</span>
<a id="__codelineno-10-2" name="__codelineno-10-2"></a>
<a id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rospy</span>
<a id="__codelineno-10-4" name="__codelineno-10-4"></a>
<a id="__codelineno-10-5" name="__codelineno-10-5"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<a id="__codelineno-10-6" name="__codelineno-10-6"></a>  <span class="n">rospy</span><span class="o">.</span><span class="n">init_node</span><span class="p">(</span><span class="s1">&#39;my_first_python_node&#39;</span><span class="p">)</span>
<a id="__codelineno-10-7" name="__codelineno-10-7"></a>  <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s1">&#39;This node has been started.&#39;</span><span class="p">)</span>
<a id="__codelineno-10-8" name="__codelineno-10-8"></a>  <span class="n">rospy</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-10-9" name="__codelineno-10-9"></a>  <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Exit now&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>Only one node with specific name can be run at a time. If you want to run more instances of the same node, change:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-11-6" name="__codelineno-11-6"></a>  <span class="n">rospy</span><span class="o">.</span><span class="n">init_node</span><span class="p">(</span><span class="s1">&#39;my_first_python_node&#39;</span><span class="p">,</span> <span class="n">anonymous</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div></p>
<p>To run, write
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>python my_first_node.py
</code></pre></div></p>
<h2 id="new-node-class">New node - class</h2>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">my_fist_node_class.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-13-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-13-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-13-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-13-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-13-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-13-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-13-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-13-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-13-10">10</a></span>
<span class="normal"><a href="#__codelineno-13-11">11</a></span>
<span class="normal"><a href="#__codelineno-13-12">12</a></span>
<span class="normal"><a href="#__codelineno-13-13">13</a></span>
<span class="normal"><a href="#__codelineno-13-14">14</a></span>
<span class="normal"><a href="#__codelineno-13-15">15</a></span>
<span class="normal"><a href="#__codelineno-13-16">16</a></span>
<span class="normal"><a href="#__codelineno-13-17">17</a></span>
<span class="normal"><a href="#__codelineno-13-18">18</a></span>
<span class="normal"><a href="#__codelineno-13-19">19</a></span>
<span class="normal"><a href="#__codelineno-13-20">20</a></span>
<span class="normal"><a href="#__codelineno-13-21">21</a></span>
<span class="normal"><a href="#__codelineno-13-22">22</a></span>
<span class="normal"><a href="#__codelineno-13-23">23</a></span>
<span class="normal"><a href="#__codelineno-13-24">24</a></span>
<span class="normal"><a href="#__codelineno-13-25">25</a></span>
<span class="normal"><a href="#__codelineno-13-26">26</a></span>
<span class="normal"><a href="#__codelineno-13-27">27</a></span>
<span class="normal"><a href="#__codelineno-13-28">28</a></span>
<span class="normal"><a href="#__codelineno-13-29">29</a></span>
<span class="normal"><a href="#__codelineno-13-30">30</a></span>
<span class="normal"><a href="#__codelineno-13-31">31</a></span>
<span class="normal"><a href="#__codelineno-13-32">32</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="ch">#!/usr/bin/env python</span>
<a id="__codelineno-13-2" name="__codelineno-13-2"></a>
<a id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rospy</span>
<a id="__codelineno-13-4" name="__codelineno-13-4"></a>
<a id="__codelineno-13-5" name="__codelineno-13-5"></a><span class="k">class</span><span class="w"> </span><span class="nc">hello_world</span><span class="p">():</span>
<a id="__codelineno-13-6" name="__codelineno-13-6"></a>
<a id="__codelineno-13-7" name="__codelineno-13-7"></a>  <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-13-8" name="__codelineno-13-8"></a>    <span class="c1"># init variables</span>
<a id="__codelineno-13-9" name="__codelineno-13-9"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">delay</span> <span class="o">=</span> <span class="mi">5</span>
<a id="__codelineno-13-10" name="__codelineno-13-10"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">ctrl_c</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-13-11" name="__codelineno-13-11"></a>    <span class="n">rospy</span><span class="o">.</span><span class="n">on_shutdown</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shutdownhook</span><span class="p">)</span>
<a id="__codelineno-13-12" name="__codelineno-13-12"></a>
<a id="__codelineno-13-13" name="__codelineno-13-13"></a>  <span class="k">def</span><span class="w"> </span><span class="nf">shutdownhook</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-13-14" name="__codelineno-13-14"></a>    <span class="c1"># works better than the rospy.is_shutdown()</span>
<a id="__codelineno-13-15" name="__codelineno-13-15"></a>    <span class="c1"># this code is run at ctrl + c</span>
<a id="__codelineno-13-16" name="__codelineno-13-16"></a>    <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s1">&#39;This node has been terminated.&#39;</span><span class="p">)</span>
<a id="__codelineno-13-17" name="__codelineno-13-17"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">ctrl_c</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-13-18" name="__codelineno-13-18"></a>
<a id="__codelineno-13-19" name="__codelineno-13-19"></a>  <span class="k">def</span><span class="w"> </span><span class="nf">test_node</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
<a id="__codelineno-13-20" name="__codelineno-13-20"></a>    <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s1">&#39;This node has been started.&#39;</span><span class="p">)</span>
<a id="__codelineno-13-21" name="__codelineno-13-21"></a>    <span class="n">rospy</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delay</span><span class="p">)</span>
<a id="__codelineno-13-22" name="__codelineno-13-22"></a>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Exit now&#39;</span><span class="p">)</span>
<a id="__codelineno-13-23" name="__codelineno-13-23"></a>
<a id="__codelineno-13-24" name="__codelineno-13-24"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<a id="__codelineno-13-25" name="__codelineno-13-25"></a>  <span class="c1"># initialise node</span>
<a id="__codelineno-13-26" name="__codelineno-13-26"></a>  <span class="n">rospy</span><span class="o">.</span><span class="n">init_node</span><span class="p">(</span><span class="s1">&#39;my_first_python_node&#39;</span><span class="p">)</span>
<a id="__codelineno-13-27" name="__codelineno-13-27"></a>  <span class="c1"># initialise class</span>
<a id="__codelineno-13-28" name="__codelineno-13-28"></a>  <span class="n">first_node</span> <span class="o">=</span> <span class="n">hello_world</span><span class="p">()</span>
<a id="__codelineno-13-29" name="__codelineno-13-29"></a>  <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-13-30" name="__codelineno-13-30"></a>    <span class="n">first_node</span><span class="o">.</span><span class="n">test_node</span><span class="p">()</span>
<a id="__codelineno-13-31" name="__codelineno-13-31"></a>  <span class="k">except</span> <span class="n">rospy</span><span class="o">.</span><span class="n">ROSInterruptException</span><span class="p">:</span>
<a id="__codelineno-13-32" name="__codelineno-13-32"></a>    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
<h2 id="debug">DEBUG</h2>
<ul>
<li><code>rosrun &lt;pkg name&gt; &lt;node name&gt;</code> - run specific node</li>
<li><code>rosnode list</code> - list of all active nodes</li>
<li><code>rosnode info &lt;node name&gt;</code> - information about hte node</li>
<li><code>rosnode kill &lt;node name&gt;</code> - shut down node</li>
<li><code>rosnode ping &lt;node name&gt;</code> - ping node (check, if it is working)</li>
</ul>
<h1 id="examples-for-raspberry-pi">Examples for Raspberry Pi</h1>
<p>Download examples on RaspberryPi.</p>
<p>Go to <code>src</code> directory:
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>roscd
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="nb">cd</span><span class="w"> </span>..
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="nb">cd</span><span class="w"> </span>src
</code></pre></div></p>
<p>Clone from GitHub:
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/ROS-FE/rpi_ros_examples.git<span class="w"> </span>.
</code></pre></div></p>
<p>Build the packages:
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>roscd
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="nb">cd</span><span class="w"> </span>..
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>catkin_make
</code></pre></div></p>
<h1 id="topics">Topics</h1>
<p>Topic is:</p>
<ul>
<li>a communication channel through which nodes exchange messages</li>
<li>one-way messaging (publisher&gt; subscriber)</li>
<li>anonymous</li>
<li>topic has its own message type (<a href="http://wiki.ros.org/std_msgs">list of standars message types</a>)</li>
<li>ROS master takes care of the proper publisher/subscriber connection</li>
<li>each node can have multiple publishers/subscribers for different topics</li>
</ul>
<h2 id="example">Example</h2>
<p>Turn on LED on button press.</p>
<p><img alt="Turn on LED on button press" src="../images/topics_1.png" title="Turn on LED on button press" /></p>
<h2 id="publisher">Publisher</h2>
<p>Syntax for publisher:
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="n">pub</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Publisher</span><span class="p">(</span><span class="s1">&#39;/topic_name&#39;</span><span class="p">,</span> <span class="n">msg_type</span><span class="p">,</span> <span class="n">queue_size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div></p>
<p>Example code:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">button_publisher.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-18-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-18-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-18-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-18-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-18-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-18-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-18-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-18-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-18-10">10</a></span>
<span class="normal"><a href="#__codelineno-18-11">11</a></span>
<span class="normal"><a href="#__codelineno-18-12">12</a></span>
<span class="normal"><a href="#__codelineno-18-13">13</a></span>
<span class="normal"><a href="#__codelineno-18-14">14</a></span>
<span class="normal"><a href="#__codelineno-18-15">15</a></span>
<span class="normal"><a href="#__codelineno-18-16">16</a></span>
<span class="normal"><a href="#__codelineno-18-17">17</a></span>
<span class="normal"><a href="#__codelineno-18-18">18</a></span>
<span class="normal"><a href="#__codelineno-18-19">19</a></span>
<span class="normal"><a href="#__codelineno-18-20">20</a></span>
<span class="normal"><a href="#__codelineno-18-21">21</a></span>
<span class="normal"><a href="#__codelineno-18-22">22</a></span>
<span class="normal"><a href="#__codelineno-18-23">23</a></span>
<span class="normal"><a href="#__codelineno-18-24">24</a></span>
<span class="normal"><a href="#__codelineno-18-25">25</a></span>
<span class="normal"><a href="#__codelineno-18-26">26</a></span>
<span class="normal"><a href="#__codelineno-18-27">27</a></span>
<span class="normal"><a href="#__codelineno-18-28">28</a></span>
<span class="normal"><a href="#__codelineno-18-29">29</a></span>
<span class="normal"><a href="#__codelineno-18-30">30</a></span>
<span class="normal"><a href="#__codelineno-18-31">31</a></span>
<span class="normal"><a href="#__codelineno-18-32">32</a></span>
<span class="normal"><a href="#__codelineno-18-33">33</a></span>
<span class="normal"><a href="#__codelineno-18-34">34</a></span>
<span class="normal"><a href="#__codelineno-18-35">35</a></span>
<span class="normal"><a href="#__codelineno-18-36">36</a></span>
<span class="normal"><a href="#__codelineno-18-37">37</a></span>
<span class="normal"><a href="#__codelineno-18-38">38</a></span>
<span class="normal"><a href="#__codelineno-18-39">39</a></span>
<span class="normal"><a href="#__codelineno-18-40">40</a></span>
<span class="normal"><a href="#__codelineno-18-41">41</a></span>
<span class="normal"><a href="#__codelineno-18-42">42</a></span>
<span class="normal"><a href="#__codelineno-18-43">43</a></span>
<span class="normal"><a href="#__codelineno-18-44">44</a></span>
<span class="normal"><a href="#__codelineno-18-45">45</a></span>
<span class="normal"><a href="#__codelineno-18-46">46</a></span>
<span class="normal"><a href="#__codelineno-18-47">47</a></span>
<span class="normal"><a href="#__codelineno-18-48">48</a></span>
<span class="normal"><a href="#__codelineno-18-49">49</a></span>
<span class="normal"><a href="#__codelineno-18-50">50</a></span>
<span class="normal"><a href="#__codelineno-18-51">51</a></span>
<span class="normal"><a href="#__codelineno-18-52">52</a></span>
<span class="normal"><a href="#__codelineno-18-53">53</a></span>
<span class="normal"><a href="#__codelineno-18-54">54</a></span>
<span class="normal"><a href="#__codelineno-18-55">55</a></span>
<span class="normal"><a href="#__codelineno-18-56">56</a></span>
<span class="normal"><a href="#__codelineno-18-57">57</a></span>
<span class="normal"><a href="#__codelineno-18-58">58</a></span>
<span class="normal"><a href="#__codelineno-18-59">59</a></span>
<span class="normal"><a href="#__codelineno-18-60">60</a></span>
<span class="normal"><a href="#__codelineno-18-61">61</a></span>
<span class="normal"><a href="#__codelineno-18-62">62</a></span>
<span class="normal"><a href="#__codelineno-18-63">63</a></span>
<span class="normal"><a href="#__codelineno-18-64">64</a></span>
<span class="normal"><a href="#__codelineno-18-65">65</a></span>
<span class="normal"><a href="#__codelineno-18-66">66</a></span>
<span class="normal"><a href="#__codelineno-18-67">67</a></span>
<span class="normal"><a href="#__codelineno-18-68">68</a></span>
<span class="normal"><a href="#__codelineno-18-69">69</a></span>
<span class="normal"><a href="#__codelineno-18-70">70</a></span>
<span class="normal"><a href="#__codelineno-18-71">71</a></span>
<span class="normal"><a href="#__codelineno-18-72">72</a></span>
<span class="normal"><a href="#__codelineno-18-73">73</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="ch">#!/usr/bin/env python</span>
<a id="__codelineno-18-2" name="__codelineno-18-2"></a>
<a id="__codelineno-18-3" name="__codelineno-18-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rospy</span>
<a id="__codelineno-18-4" name="__codelineno-18-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">RPi.GPIO</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">GPIO</span>
<a id="__codelineno-18-5" name="__codelineno-18-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">std_msgs.msg</span><span class="w"> </span><span class="kn">import</span> <span class="n">Bool</span>
<a id="__codelineno-18-6" name="__codelineno-18-6"></a>
<a id="__codelineno-18-7" name="__codelineno-18-7"></a><span class="c1"># buttons GPIO pins </span>
<a id="__codelineno-18-8" name="__codelineno-18-8"></a><span class="c1">#   button 1 - gpio 11</span>
<a id="__codelineno-18-9" name="__codelineno-18-9"></a><span class="c1">#   button 2 - gpio 12</span>
<a id="__codelineno-18-10" name="__codelineno-18-10"></a>
<a id="__codelineno-18-11" name="__codelineno-18-11"></a><span class="k">class</span><span class="w"> </span><span class="nc">rpi_button</span><span class="p">():</span>
<a id="__codelineno-18-12" name="__codelineno-18-12"></a>
<a id="__codelineno-18-13" name="__codelineno-18-13"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-18-14" name="__codelineno-18-14"></a>        <span class="c1"># init variables</span>
<a id="__codelineno-18-15" name="__codelineno-18-15"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">BUTTON_GPIO</span> <span class="o">=</span> <span class="mi">11</span>
<a id="__codelineno-18-16" name="__codelineno-18-16"></a>        <span class="c1"># set GPIO kot BCM</span>
<a id="__codelineno-18-17" name="__codelineno-18-17"></a>        <span class="n">GPIO</span><span class="o">.</span><span class="n">setmode</span><span class="p">(</span><span class="n">GPIO</span><span class="o">.</span><span class="n">BCM</span><span class="p">)</span>
<a id="__codelineno-18-18" name="__codelineno-18-18"></a>        <span class="c1"># set button IO as input</span>
<a id="__codelineno-18-19" name="__codelineno-18-19"></a>        <span class="n">GPIO</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">BUTTON_GPIO</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">IN</span><span class="p">)</span>
<a id="__codelineno-18-20" name="__codelineno-18-20"></a>        <span class="c1"># set loop frequency to 10 Hz</span>
<a id="__codelineno-18-21" name="__codelineno-18-21"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rate</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Rate</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-18-22" name="__codelineno-18-22"></a>
<a id="__codelineno-18-23" name="__codelineno-18-23"></a>        <span class="c1"># define publisher</span>
<a id="__codelineno-18-24" name="__codelineno-18-24"></a>        <span class="c1"># rospy.Publisher(&quot;topic_name&quot;, varType, queue_size)</span>
<a id="__codelineno-18-25" name="__codelineno-18-25"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pub</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Publisher</span><span class="p">(</span><span class="s1">&#39;/button_state&#39;</span><span class="p">,</span> <span class="n">Bool</span><span class="p">,</span> <span class="n">queue_size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-18-26" name="__codelineno-18-26"></a>
<a id="__codelineno-18-27" name="__codelineno-18-27"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl_c</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-18-28" name="__codelineno-18-28"></a>        <span class="n">rospy</span><span class="o">.</span><span class="n">on_shutdown</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shutdownhook</span><span class="p">)</span>
<a id="__codelineno-18-29" name="__codelineno-18-29"></a>
<a id="__codelineno-18-30" name="__codelineno-18-30"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">read_button</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-18-31" name="__codelineno-18-31"></a>        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrl_c</span><span class="p">:</span>
<a id="__codelineno-18-32" name="__codelineno-18-32"></a>            <span class="c1">#  read GPIO pin</span>
<a id="__codelineno-18-33" name="__codelineno-18-33"></a>            <span class="n">gpio_state</span> <span class="o">=</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">BUTTON_GPIO</span><span class="p">)</span>
<a id="__codelineno-18-34" name="__codelineno-18-34"></a>            <span class="c1"># define msg as Bool variable</span>
<a id="__codelineno-18-35" name="__codelineno-18-35"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">Bool</span><span class="p">()</span>
<a id="__codelineno-18-36" name="__codelineno-18-36"></a>            <span class="c1"># msg has a data &quot;data&quot;</span>
<a id="__codelineno-18-37" name="__codelineno-18-37"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">gpio_state</span>
<a id="__codelineno-18-38" name="__codelineno-18-38"></a>            <span class="c1"># send msg</span>
<a id="__codelineno-18-39" name="__codelineno-18-39"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">publish_once</span><span class="p">()</span>
<a id="__codelineno-18-40" name="__codelineno-18-40"></a>
<a id="__codelineno-18-41" name="__codelineno-18-41"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">publish_once</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-18-42" name="__codelineno-18-42"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-18-43" name="__codelineno-18-43"></a><span class="sd">        This is because publishing in topics sometimes fails the first time you publish.</span>
<a id="__codelineno-18-44" name="__codelineno-18-44"></a><span class="sd">        In continuous publishing systems, this is no big deal, but in systems that publish only</span>
<a id="__codelineno-18-45" name="__codelineno-18-45"></a><span class="sd">        once, it IS very important.</span>
<a id="__codelineno-18-46" name="__codelineno-18-46"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-18-47" name="__codelineno-18-47"></a>        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrl_c</span><span class="p">:</span>
<a id="__codelineno-18-48" name="__codelineno-18-48"></a>            <span class="n">connections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">get_num_connections</span><span class="p">()</span>
<a id="__codelineno-18-49" name="__codelineno-18-49"></a>            <span class="k">if</span> <span class="n">connections</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-18-50" name="__codelineno-18-50"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-18-51" name="__codelineno-18-51"></a>                <span class="c1">#rospy.loginfo(&quot;Msg Published&quot;)</span>
<a id="__codelineno-18-52" name="__codelineno-18-52"></a>                <span class="k">break</span>
<a id="__codelineno-18-53" name="__codelineno-18-53"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-18-54" name="__codelineno-18-54"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">rate</span><span class="o">.</span><span class="n">sleep</span><span class="p">()</span>
<a id="__codelineno-18-55" name="__codelineno-18-55"></a>
<a id="__codelineno-18-56" name="__codelineno-18-56"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">shutdownhook</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-18-57" name="__codelineno-18-57"></a>        <span class="c1"># works better than the rospy.is_shutdown()</span>
<a id="__codelineno-18-58" name="__codelineno-18-58"></a>        <span class="c1"># this code is run at ctrl + c</span>
<a id="__codelineno-18-59" name="__codelineno-18-59"></a>
<a id="__codelineno-18-60" name="__codelineno-18-60"></a>        <span class="c1"># clear all GPIO settings</span>
<a id="__codelineno-18-61" name="__codelineno-18-61"></a>        <span class="n">GPIO</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
<a id="__codelineno-18-62" name="__codelineno-18-62"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl_c</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-18-63" name="__codelineno-18-63"></a>
<a id="__codelineno-18-64" name="__codelineno-18-64"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<a id="__codelineno-18-65" name="__codelineno-18-65"></a>    <span class="c1"># initialise node</span>
<a id="__codelineno-18-66" name="__codelineno-18-66"></a>    <span class="n">rospy</span><span class="o">.</span><span class="n">init_node</span><span class="p">(</span><span class="s1">&#39;button_state_publisher&#39;</span><span class="p">,</span> <span class="n">anonymous</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-18-67" name="__codelineno-18-67"></a>
<a id="__codelineno-18-68" name="__codelineno-18-68"></a>    <span class="c1"># initialise class</span>
<a id="__codelineno-18-69" name="__codelineno-18-69"></a>    <span class="n">btn</span> <span class="o">=</span> <span class="n">rpi_button</span><span class="p">()</span>
<a id="__codelineno-18-70" name="__codelineno-18-70"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-18-71" name="__codelineno-18-71"></a>        <span class="n">btn</span><span class="o">.</span><span class="n">read_button</span><span class="p">()</span>
<a id="__codelineno-18-72" name="__codelineno-18-72"></a>    <span class="k">except</span> <span class="n">rospy</span><span class="o">.</span><span class="n">ROSInterruptException</span><span class="p">:</span>
<a id="__codelineno-18-73" name="__codelineno-18-73"></a>        <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
<p>To test the code run
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>rosrun rpi_feros button_publisher.py
</code></pre></div>
check the list of topics (look for <code>/button_state</code>)
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>rostopic list
</code></pre></div>
Then listen to that topic
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>rostopic echo /button_state -c
</code></pre></div>
and press the button on RaspberryPi.</p>
<h2 id="subscriber">Subscriber</h2>
<p>Syntax for subscriber:
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="n">sub</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Subscriber</span><span class="p">(</span><span class="s1">&#39;/topic_name&#39;</span><span class="p">,</span> <span class="n">msg_type</span><span class="p">,</span> <span class="n">callback_fcn</span><span class="p">)</span>
</code></pre></div>
Example code:
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">led_actuator.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-23-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-23-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-23-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-23-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-23-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-23-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-23-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-23-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-23-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-23-10">10</a></span>
<span class="normal"><a href="#__codelineno-23-11">11</a></span>
<span class="normal"><a href="#__codelineno-23-12">12</a></span>
<span class="normal"><a href="#__codelineno-23-13">13</a></span>
<span class="normal"><a href="#__codelineno-23-14">14</a></span>
<span class="normal"><a href="#__codelineno-23-15">15</a></span>
<span class="normal"><a href="#__codelineno-23-16">16</a></span>
<span class="normal"><a href="#__codelineno-23-17">17</a></span>
<span class="normal"><a href="#__codelineno-23-18">18</a></span>
<span class="normal"><a href="#__codelineno-23-19">19</a></span>
<span class="normal"><a href="#__codelineno-23-20">20</a></span>
<span class="normal"><a href="#__codelineno-23-21">21</a></span>
<span class="normal"><a href="#__codelineno-23-22">22</a></span>
<span class="normal"><a href="#__codelineno-23-23">23</a></span>
<span class="normal"><a href="#__codelineno-23-24">24</a></span>
<span class="normal"><a href="#__codelineno-23-25">25</a></span>
<span class="normal"><a href="#__codelineno-23-26">26</a></span>
<span class="normal"><a href="#__codelineno-23-27">27</a></span>
<span class="normal"><a href="#__codelineno-23-28">28</a></span>
<span class="normal"><a href="#__codelineno-23-29">29</a></span>
<span class="normal"><a href="#__codelineno-23-30">30</a></span>
<span class="normal"><a href="#__codelineno-23-31">31</a></span>
<span class="normal"><a href="#__codelineno-23-32">32</a></span>
<span class="normal"><a href="#__codelineno-23-33">33</a></span>
<span class="normal"><a href="#__codelineno-23-34">34</a></span>
<span class="normal"><a href="#__codelineno-23-35">35</a></span>
<span class="normal"><a href="#__codelineno-23-36">36</a></span>
<span class="normal"><a href="#__codelineno-23-37">37</a></span>
<span class="normal"><a href="#__codelineno-23-38">38</a></span>
<span class="normal"><a href="#__codelineno-23-39">39</a></span>
<span class="normal"><a href="#__codelineno-23-40">40</a></span>
<span class="normal"><a href="#__codelineno-23-41">41</a></span>
<span class="normal"><a href="#__codelineno-23-42">42</a></span>
<span class="normal"><a href="#__codelineno-23-43">43</a></span>
<span class="normal"><a href="#__codelineno-23-44">44</a></span>
<span class="normal"><a href="#__codelineno-23-45">45</a></span>
<span class="normal"><a href="#__codelineno-23-46">46</a></span>
<span class="normal"><a href="#__codelineno-23-47">47</a></span>
<span class="normal"><a href="#__codelineno-23-48">48</a></span>
<span class="normal"><a href="#__codelineno-23-49">49</a></span>
<span class="normal"><a href="#__codelineno-23-50">50</a></span>
<span class="normal"><a href="#__codelineno-23-51">51</a></span>
<span class="normal"><a href="#__codelineno-23-52">52</a></span>
<span class="normal"><a href="#__codelineno-23-53">53</a></span>
<span class="normal"><a href="#__codelineno-23-54">54</a></span>
<span class="normal"><a href="#__codelineno-23-55">55</a></span>
<span class="normal"><a href="#__codelineno-23-56">56</a></span>
<span class="normal"><a href="#__codelineno-23-57">57</a></span>
<span class="normal"><a href="#__codelineno-23-58">58</a></span>
<span class="normal"><a href="#__codelineno-23-59">59</a></span>
<span class="normal"><a href="#__codelineno-23-60">60</a></span>
<span class="normal"><a href="#__codelineno-23-61">61</a></span>
<span class="normal"><a href="#__codelineno-23-62">62</a></span>
<span class="normal"><a href="#__codelineno-23-63">63</a></span>
<span class="normal"><a href="#__codelineno-23-64">64</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="ch">#!/usr/bin/env python</span>
<a id="__codelineno-23-2" name="__codelineno-23-2"></a>
<a id="__codelineno-23-3" name="__codelineno-23-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rospy</span>
<a id="__codelineno-23-4" name="__codelineno-23-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">std_msgs.msg</span><span class="w"> </span><span class="kn">import</span> <span class="n">Bool</span>
<a id="__codelineno-23-5" name="__codelineno-23-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">RPi.GPIO</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">GPIO</span>
<a id="__codelineno-23-6" name="__codelineno-23-6"></a>
<a id="__codelineno-23-7" name="__codelineno-23-7"></a><span class="c1"># GPIO za LED:</span>
<a id="__codelineno-23-8" name="__codelineno-23-8"></a><span class="c1">#   Green 1 - GPIO 2</span>
<a id="__codelineno-23-9" name="__codelineno-23-9"></a><span class="c1">#   Green 2 - GPIO 3</span>
<a id="__codelineno-23-10" name="__codelineno-23-10"></a><span class="c1">#   Yellow 1 - GPIO 4</span>
<a id="__codelineno-23-11" name="__codelineno-23-11"></a><span class="c1">#   Yellow 2 - GPIO 5</span>
<a id="__codelineno-23-12" name="__codelineno-23-12"></a><span class="c1">#   Red 1 - GPIO 6</span>
<a id="__codelineno-23-13" name="__codelineno-23-13"></a><span class="c1">#   Red 2 - GPIO 7</span>
<a id="__codelineno-23-14" name="__codelineno-23-14"></a>
<a id="__codelineno-23-15" name="__codelineno-23-15"></a><span class="k">class</span><span class="w"> </span><span class="nc">rpi_led</span><span class="p">():</span>
<a id="__codelineno-23-16" name="__codelineno-23-16"></a>
<a id="__codelineno-23-17" name="__codelineno-23-17"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-23-18" name="__codelineno-23-18"></a>        <span class="c1"># init variables</span>
<a id="__codelineno-23-19" name="__codelineno-23-19"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">LED_GPIO</span> <span class="o">=</span> <span class="mi">7</span>
<a id="__codelineno-23-20" name="__codelineno-23-20"></a>        <span class="c1"># set GPIO kot BCM</span>
<a id="__codelineno-23-21" name="__codelineno-23-21"></a>        <span class="n">GPIO</span><span class="o">.</span><span class="n">setmode</span><span class="p">(</span><span class="n">GPIO</span><span class="o">.</span><span class="n">BCM</span><span class="p">)</span>
<a id="__codelineno-23-22" name="__codelineno-23-22"></a>        <span class="c1"># set all leds</span>
<a id="__codelineno-23-23" name="__codelineno-23-23"></a>        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">8</span><span class="p">):</span>
<a id="__codelineno-23-24" name="__codelineno-23-24"></a>            <span class="c1"># set IO as outputs</span>
<a id="__codelineno-23-25" name="__codelineno-23-25"></a>            <span class="n">GPIO</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">GPIO</span><span class="o">.</span><span class="n">OUT</span><span class="p">)</span>
<a id="__codelineno-23-26" name="__codelineno-23-26"></a>
<a id="__codelineno-23-27" name="__codelineno-23-27"></a>        <span class="c1"># define subscriber</span>
<a id="__codelineno-23-28" name="__codelineno-23-28"></a>        <span class="c1"># rospy.Subscriber(&#39;topic_name&#39;, varType, callback)</span>
<a id="__codelineno-23-29" name="__codelineno-23-29"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sub</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Subscriber</span><span class="p">(</span><span class="s1">&#39;/button_state&#39;</span><span class="p">,</span> <span class="n">Bool</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">button_state_callback</span><span class="p">)</span>
<a id="__codelineno-23-30" name="__codelineno-23-30"></a>
<a id="__codelineno-23-31" name="__codelineno-23-31"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl_c</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-23-32" name="__codelineno-23-32"></a>        <span class="n">rospy</span><span class="o">.</span><span class="n">on_shutdown</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shutdownhook</span><span class="p">)</span>
<a id="__codelineno-23-33" name="__codelineno-23-33"></a>
<a id="__codelineno-23-34" name="__codelineno-23-34"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">button_state_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
<a id="__codelineno-23-35" name="__codelineno-23-35"></a>        <span class="c1"># the code that is executed when data is received</span>
<a id="__codelineno-23-36" name="__codelineno-23-36"></a>        <span class="c1"># turn on LED</span>
<a id="__codelineno-23-37" name="__codelineno-23-37"></a>        <span class="n">GPIO</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">LED_GPIO</span><span class="p">,</span> <span class="n">msg</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-23-38" name="__codelineno-23-38"></a>
<a id="__codelineno-23-39" name="__codelineno-23-39"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">resetLed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-23-40" name="__codelineno-23-40"></a>        <span class="c1"># reset all leds</span>
<a id="__codelineno-23-41" name="__codelineno-23-41"></a>        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">8</span><span class="p">):</span>
<a id="__codelineno-23-42" name="__codelineno-23-42"></a>            <span class="c1"># turn off all leds</span>
<a id="__codelineno-23-43" name="__codelineno-23-43"></a>            <span class="n">GPIO</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-23-44" name="__codelineno-23-44"></a>
<a id="__codelineno-23-45" name="__codelineno-23-45"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">shutdownhook</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-23-46" name="__codelineno-23-46"></a>        <span class="c1"># works better than the rospy.is_shutdown()</span>
<a id="__codelineno-23-47" name="__codelineno-23-47"></a>        <span class="c1"># this code is run at ctrl + c</span>
<a id="__codelineno-23-48" name="__codelineno-23-48"></a>
<a id="__codelineno-23-49" name="__codelineno-23-49"></a>        <span class="c1"># clear all settings</span>
<a id="__codelineno-23-50" name="__codelineno-23-50"></a>        <span class="n">GPIO</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
<a id="__codelineno-23-51" name="__codelineno-23-51"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl_c</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-23-52" name="__codelineno-23-52"></a>
<a id="__codelineno-23-53" name="__codelineno-23-53"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<a id="__codelineno-23-54" name="__codelineno-23-54"></a>    <span class="c1"># initialise node</span>
<a id="__codelineno-23-55" name="__codelineno-23-55"></a>    <span class="n">rospy</span><span class="o">.</span><span class="n">init_node</span><span class="p">(</span><span class="s1">&#39;led_actuator&#39;</span><span class="p">)</span>
<a id="__codelineno-23-56" name="__codelineno-23-56"></a>    <span class="c1"># initialise class</span>
<a id="__codelineno-23-57" name="__codelineno-23-57"></a>    <span class="n">led_act</span> <span class="o">=</span> <span class="n">rpi_led</span><span class="p">()</span>
<a id="__codelineno-23-58" name="__codelineno-23-58"></a>    <span class="c1"># reset leds</span>
<a id="__codelineno-23-59" name="__codelineno-23-59"></a>    <span class="n">led_act</span><span class="o">.</span><span class="n">resetLed</span><span class="p">()</span>
<a id="__codelineno-23-60" name="__codelineno-23-60"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-23-61" name="__codelineno-23-61"></a>        <span class="c1"># loop</span>
<a id="__codelineno-23-62" name="__codelineno-23-62"></a>        <span class="n">rospy</span><span class="o">.</span><span class="n">spin</span><span class="p">()</span>
<a id="__codelineno-23-63" name="__codelineno-23-63"></a>    <span class="k">except</span> <span class="n">rospy</span><span class="o">.</span><span class="n">ROSInterruptException</span><span class="p">:</span>
<a id="__codelineno-23-64" name="__codelineno-23-64"></a>        <span class="k">pass</span>
</code></pre></div></td></tr></table></div></p>
<p>To test the code run
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>rosrun rpi_feros led_actuator.py
</code></pre></div></p>
<p>After that check topics (loook for <code>/button_state</code>):
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>rostopic list
</code></pre></div></p>
<p>Use <code>rostopic pub</code> to turn LED on and off:
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>rostopic pub /button_state std_msgs/Bool &quot;data: True&quot;
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>rostopic pub /button_state std_msgs/Bool &quot;data: False&quot;
</code></pre></div></p>
<p>To test both (publisher and subscriber), run each in  the invidual terminal:
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>rosrun rpi_feros button_publisher.py
</code></pre></div>
and
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>rosrun rpi_feros led_actuator.py
</code></pre></div>
When pressing the button on RPi, the LED should turn on.</p>
<h2 id="debug_1">DEBUG</h2>
<ul>
<li><code>rostopic -h</code> - rostopic help</li>
<li><code>rostopic list</code> - list of all active topics</li>
<li><code>rostopic echo &lt;topic name&gt;</code> - listen to selected topic</li>
<li><code>-c</code> - clear output each time</li>
<li><code>-n2</code> - print only 2 outputs</li>
<li><code>rostopic info &lt;topic name&gt;</code> - information about topic</li>
<li><code>rostopic pub &lt;topic name&gt;</code> + <code>Tab</code> for autocomplete - publish data</li>
<li><code>-1</code> - publish only once</li>
<li><code>-r5</code>- publish with 5 Hz</li>
</ul>
<h2 id="exercise">Exercise</h2>
<p>Turn on LED if the object is closer than 0.2 m.</p>
<p><img alt="Turn on LED if the object is closer than 0.2 m" src="../images/topics_2.png" title="Turn on LED if the object is closer than 0.2 m" /></p>
<h1 id="roslaunch">Roslaunch</h1>
<p>Roslaunch is a tool for easily launching multiple ROS nodes as well as setting parameters. Roslaunch takes in one or more XML configuration files (with the .launch extension) that specify the parameters to set and nodes to launch, as well as the machines that they should be run on.</p>
<p>Basic sytax is
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="nt">&lt;launch&gt;</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="w">  </span><span class="nt">&lt;param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;/parameter_name&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;variable_type&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;variable_value&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="w">  </span><span class="nt">&lt;node</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;name_of_the_node&quot;</span><span class="w"> </span><span class="na">pkg=</span><span class="s">&quot;name_of_the_package&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;source_file.py&quot;</span><span class="w"> </span><span class="na">ns=</span><span class="s">&quot;namespace&quot;</span><span class="w"> </span><span class="na">args=</span><span class="s">&quot;optional arguments&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="w">  </span><span class="nt">&lt;include</span><span class="w"> </span><span class="na">file=</span><span class="s">&quot;included.launch&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="w">    </span><span class="nt">&lt;arg</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;arg_name&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;arg_val&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="w">  </span><span class="nt">&lt;/include&gt;</span>
<a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a><span class="nt">&lt;/launch&gt;</span>
</code></pre></div></p>
<h3 id="new-launch">New .launch</h3>
<p>Create new package <code>rpi_feros_bringup</code> used for launch files:
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>roscd
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>cd ..
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>cd src
<a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>catkin_create_pkg rpi_feros_bringup
</code></pre></div>
and do <code>catkin_make</code>.</p>
<p>Go the new package and create folder <code>launch</code>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>roscd rpi_feros_bringup
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>mkdir launch
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a>cd launch
</code></pre></div></p>
<p>Inside the folder create new file <code>feros.launch</code>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>touch rpi_led.launch
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a>code rpi_led.launch
</code></pre></div></p>
<p>Copy the following lines
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">rpi_led.launch</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-33-1">1</a></span>
<span class="normal"><a href="#__codelineno-33-2">2</a></span>
<span class="normal"><a href="#__codelineno-33-3">3</a></span>
<span class="normal"><a href="#__codelineno-33-4">4</a></span>
<span class="normal"><a href="#__codelineno-33-5">5</a></span>
<span class="normal"><a href="#__codelineno-33-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1"></a><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a id="__codelineno-33-2" name="__codelineno-33-2"></a>
<a id="__codelineno-33-3" name="__codelineno-33-3"></a><span class="nt">&lt;launch&gt;</span>
<a id="__codelineno-33-4" name="__codelineno-33-4"></a><span class="w">    </span><span class="nt">&lt;node</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;btn_pub&quot;</span><span class="w"> </span><span class="na">pkg=</span><span class="s">&quot;rpi_feros&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;button_publisher.py&quot;</span><span class="w"> </span><span class="na">output=</span><span class="s">&quot;screen&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-33-5" name="__codelineno-33-5"></a><span class="w">    </span><span class="nt">&lt;node</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;led_act&quot;</span><span class="w"> </span><span class="na">pkg=</span><span class="s">&quot;rpi_feros&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;led_actuator.py&quot;</span><span class="w"> </span><span class="na">output=</span><span class="s">&quot;screen&quot;</span><span class="nt">/&gt;</span><span class="w">   </span>
<a id="__codelineno-33-6" name="__codelineno-33-6"></a><span class="nt">&lt;/launch&gt;</span>
</code></pre></div></td></tr></table></div></p>
<p>To run the <code>rpi_led.launch</code> use <code>roslaunch</code> function
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a>roslaunch rpi_feros_bringup rpi_led.launch
</code></pre></div></p>
<p>By running this .launch file three things are started</p>
<ul>
<li><code>roscore</code> (automatically),</li>
<li><code>button_publisher.py</code>, and</li>
<li><code>led_actuator.py</code>.</li>
</ul>
<h1 id="ros-network">ROS network</h1>
<ul>
<li>one ROS master in the entire network</li>
<li>all nodes must use the same ROS master (<code>ROS_MASTER_URI</code>)</li>
<li>two-way connection between devices</li>
<li>each device must present itself with a name that other devices recognize</li>
</ul>
<p><a href="http://wiki.ros.org/ROS/Tutorials/MultipleMachines">http://wiki.ros.org/ROS/Tutorials/MultipleMachines</a></p>
<p><a href="http://wiki.ros.org/ROS/NetworkSetup">http://wiki.ros.org/ROS/NetworkSetup</a></p>
<h2 id="connection">Connection</h2>
<p><code>ping</code> the remote computer (hostname: IP or name)
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a>ping 192.168.65.60
</code></pre></div></p>
<p>Use <code>ssh</code> to connect to remote computer and ping your computer
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a>ssh student@192.168.65.60
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>ping 192.168.65.50
</code></pre></div></p>
<h2 id="ros_master_uri">ROS_MASTER_URI</h2>
<p>ROS master is set with variable <code>ROS_MASTER_URI</code>. It needs to be set withing each terminal.
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a>export ROS_MASTER_URI=http://[hostname]:11311
</code></pre></div>
To check, use
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a>echo $ROS_MASTER_URI
</code></pre></div></p>
<p>Set parameter <code>ROS_IP</code> for IP or <code>ROS_HOSTNAME</code>for hostname if you have multiple addresses for a computer and need to force ROS to a particular one.</p>
<p>To do this automatically, add command to <code>bashrc</code>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a>sudo nano ~/.bashrc
</code></pre></div>
Add
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a>export ROS_MASTER_URI=http://[hostname]:11311
</code></pre></div></p>
<p>ATTENTION!</p>
<p>This can cause a problem, it you would like to run ROS master on the local computer.</p>
<h2 id="test-connection">Test connection</h2>
<p>It is important to test connection in both ways:</p>
<ul>
<li>master (publisher) &gt;&gt;&gt; others (subscriber)</li>
<li>master (subscribers) &lt;&lt;&lt; others (publisher) </li>
</ul>
<p>Publisher:
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a>rostopic pub /test_connection std_msgs/Bool &quot;data: True&quot;
</code></pre></div></p>
<p>Subscriber:
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a>rostopic list
<a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a>
<a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a>rostopic echo /test_connection
</code></pre></div></p>
<h2 id="exercise_1">Exercise</h2>
<p>Connect to master computer with Sick Nanoscan3 and connect to topic <code>/sick_safetyscanners/scan</code>.</p>
<h1 id="services">Services</h1>
<ul>
<li>Server/client system</li>
<li>Synchronous operation</li>
<li>For calculation and quick actions</li>
<li>One message type for Request, another message type for Response</li>
<li>A server is only one that can respond to multiple clients</li>
</ul>
<h2 id="example_1">Example</h2>
<p>Turn on LED on button press using interrupts.</p>
<p><img alt="Turn on LED on button press" src="../images/service_1.png" title="Turn on LED on button press" /></p>
<h2 id="server">Server</h2>
<p>Syntax for service server:
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="n">service</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Service</span><span class="p">(</span><span class="s1">&#39;/service_name&#39;</span><span class="p">,</span> <span class="n">msg_type</span><span class="p">,</span> <span class="n">handle_fcn</span><span class="p">)</span>
</code></pre></div></p>
<p>Example code:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">led_service_server.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-44-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-44-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-44-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-44-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-44-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-44-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-44-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-44-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-44-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-44-10">10</a></span>
<span class="normal"><a href="#__codelineno-44-11">11</a></span>
<span class="normal"><a href="#__codelineno-44-12">12</a></span>
<span class="normal"><a href="#__codelineno-44-13">13</a></span>
<span class="normal"><a href="#__codelineno-44-14">14</a></span>
<span class="normal"><a href="#__codelineno-44-15">15</a></span>
<span class="normal"><a href="#__codelineno-44-16">16</a></span>
<span class="normal"><a href="#__codelineno-44-17">17</a></span>
<span class="normal"><a href="#__codelineno-44-18">18</a></span>
<span class="normal"><a href="#__codelineno-44-19">19</a></span>
<span class="normal"><a href="#__codelineno-44-20">20</a></span>
<span class="normal"><a href="#__codelineno-44-21">21</a></span>
<span class="normal"><a href="#__codelineno-44-22">22</a></span>
<span class="normal"><a href="#__codelineno-44-23">23</a></span>
<span class="normal"><a href="#__codelineno-44-24">24</a></span>
<span class="normal"><a href="#__codelineno-44-25">25</a></span>
<span class="normal"><a href="#__codelineno-44-26">26</a></span>
<span class="normal"><a href="#__codelineno-44-27">27</a></span>
<span class="normal"><a href="#__codelineno-44-28">28</a></span>
<span class="normal"><a href="#__codelineno-44-29">29</a></span>
<span class="normal"><a href="#__codelineno-44-30">30</a></span>
<span class="normal"><a href="#__codelineno-44-31">31</a></span>
<span class="normal"><a href="#__codelineno-44-32">32</a></span>
<span class="normal"><a href="#__codelineno-44-33">33</a></span>
<span class="normal"><a href="#__codelineno-44-34">34</a></span>
<span class="normal"><a href="#__codelineno-44-35">35</a></span>
<span class="normal"><a href="#__codelineno-44-36">36</a></span>
<span class="normal"><a href="#__codelineno-44-37">37</a></span>
<span class="normal"><a href="#__codelineno-44-38">38</a></span>
<span class="normal"><a href="#__codelineno-44-39">39</a></span>
<span class="normal"><a href="#__codelineno-44-40">40</a></span>
<span class="normal"><a href="#__codelineno-44-41">41</a></span>
<span class="normal"><a href="#__codelineno-44-42">42</a></span>
<span class="normal"><a href="#__codelineno-44-43">43</a></span>
<span class="normal"><a href="#__codelineno-44-44">44</a></span>
<span class="normal"><a href="#__codelineno-44-45">45</a></span>
<span class="normal"><a href="#__codelineno-44-46">46</a></span>
<span class="normal"><a href="#__codelineno-44-47">47</a></span>
<span class="normal"><a href="#__codelineno-44-48">48</a></span>
<span class="normal"><a href="#__codelineno-44-49">49</a></span>
<span class="normal"><a href="#__codelineno-44-50">50</a></span>
<span class="normal"><a href="#__codelineno-44-51">51</a></span>
<span class="normal"><a href="#__codelineno-44-52">52</a></span>
<span class="normal"><a href="#__codelineno-44-53">53</a></span>
<span class="normal"><a href="#__codelineno-44-54">54</a></span>
<span class="normal"><a href="#__codelineno-44-55">55</a></span>
<span class="normal"><a href="#__codelineno-44-56">56</a></span>
<span class="normal"><a href="#__codelineno-44-57">57</a></span>
<span class="normal"><a href="#__codelineno-44-58">58</a></span>
<span class="normal"><a href="#__codelineno-44-59">59</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1"></a><span class="ch">#!/usr/bin/env python</span>
<a id="__codelineno-44-2" name="__codelineno-44-2"></a>
<a id="__codelineno-44-3" name="__codelineno-44-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rospy</span>
<a id="__codelineno-44-4" name="__codelineno-44-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">std_srvs.srv</span><span class="w"> </span><span class="kn">import</span> <span class="n">SetBool</span>
<a id="__codelineno-44-5" name="__codelineno-44-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">RPi.GPIO</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">GPIO</span>
<a id="__codelineno-44-6" name="__codelineno-44-6"></a>
<a id="__codelineno-44-7" name="__codelineno-44-7"></a><span class="k">class</span><span class="w"> </span><span class="nc">ledServer</span><span class="p">():</span>
<a id="__codelineno-44-8" name="__codelineno-44-8"></a>
<a id="__codelineno-44-9" name="__codelineno-44-9"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-44-10" name="__codelineno-44-10"></a>        <span class="c1"># init variables</span>
<a id="__codelineno-44-11" name="__codelineno-44-11"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">LED_GPIO</span> <span class="o">=</span> <span class="mi">2</span>
<a id="__codelineno-44-12" name="__codelineno-44-12"></a>        <span class="c1"># set GPIO kot BCM</span>
<a id="__codelineno-44-13" name="__codelineno-44-13"></a>        <span class="n">GPIO</span><span class="o">.</span><span class="n">setmode</span><span class="p">(</span><span class="n">GPIO</span><span class="o">.</span><span class="n">BCM</span><span class="p">)</span>
<a id="__codelineno-44-14" name="__codelineno-44-14"></a>        <span class="c1"># set all leds</span>
<a id="__codelineno-44-15" name="__codelineno-44-15"></a>        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">8</span><span class="p">):</span>
<a id="__codelineno-44-16" name="__codelineno-44-16"></a>            <span class="c1"># set IO as outputs</span>
<a id="__codelineno-44-17" name="__codelineno-44-17"></a>            <span class="n">GPIO</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">GPIO</span><span class="o">.</span><span class="n">OUT</span><span class="p">)</span>
<a id="__codelineno-44-18" name="__codelineno-44-18"></a>
<a id="__codelineno-44-19" name="__codelineno-44-19"></a>        <span class="c1"># define service</span>
<a id="__codelineno-44-20" name="__codelineno-44-20"></a>        <span class="c1"># rospy.Service(&#39;service_name&#39;,varType,callback)</span>
<a id="__codelineno-44-21" name="__codelineno-44-21"></a>        <span class="n">rospy</span><span class="o">.</span><span class="n">Service</span><span class="p">(</span><span class="s1">&#39;/set_led_state&#39;</span><span class="p">,</span> <span class="n">SetBool</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_led_status_callback</span><span class="p">)</span>
<a id="__codelineno-44-22" name="__codelineno-44-22"></a>        <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s2">&quot;Service server started. Ready to get request.&quot;</span><span class="p">)</span>
<a id="__codelineno-44-23" name="__codelineno-44-23"></a>
<a id="__codelineno-44-24" name="__codelineno-44-24"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl_c</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-44-25" name="__codelineno-44-25"></a>        <span class="n">rospy</span><span class="o">.</span><span class="n">on_shutdown</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shutdownhook</span><span class="p">)</span>
<a id="__codelineno-44-26" name="__codelineno-44-26"></a>
<a id="__codelineno-44-27" name="__codelineno-44-27"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_led_status_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">req</span><span class="p">):</span> 
<a id="__codelineno-44-28" name="__codelineno-44-28"></a>        <span class="c1"># code that is executed when request is received</span>
<a id="__codelineno-44-29" name="__codelineno-44-29"></a>        <span class="c1"># set LED to req.data</span>
<a id="__codelineno-44-30" name="__codelineno-44-30"></a>        <span class="n">GPIO</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">LED_GPIO</span><span class="p">,</span> <span class="n">req</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-44-31" name="__codelineno-44-31"></a>        <span class="c1"># server response</span>
<a id="__codelineno-44-32" name="__codelineno-44-32"></a>        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span><span class="s1">&#39;Successfully changed LED state.&#39;</span><span class="p">}</span>
<a id="__codelineno-44-33" name="__codelineno-44-33"></a>
<a id="__codelineno-44-34" name="__codelineno-44-34"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">resetLed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-44-35" name="__codelineno-44-35"></a>        <span class="c1"># reset all leds</span>
<a id="__codelineno-44-36" name="__codelineno-44-36"></a>        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">8</span><span class="p">):</span>
<a id="__codelineno-44-37" name="__codelineno-44-37"></a>            <span class="c1"># turn off all leds</span>
<a id="__codelineno-44-38" name="__codelineno-44-38"></a>            <span class="n">GPIO</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-44-39" name="__codelineno-44-39"></a>
<a id="__codelineno-44-40" name="__codelineno-44-40"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">shutdownhook</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-44-41" name="__codelineno-44-41"></a>        <span class="c1"># works better than the rospy.is_shutdown()</span>
<a id="__codelineno-44-42" name="__codelineno-44-42"></a>        <span class="c1"># this code is run at ctrl + c</span>
<a id="__codelineno-44-43" name="__codelineno-44-43"></a>
<a id="__codelineno-44-44" name="__codelineno-44-44"></a>        <span class="c1"># clear all settings</span>
<a id="__codelineno-44-45" name="__codelineno-44-45"></a>        <span class="n">GPIO</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
<a id="__codelineno-44-46" name="__codelineno-44-46"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl_c</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-44-47" name="__codelineno-44-47"></a>
<a id="__codelineno-44-48" name="__codelineno-44-48"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<a id="__codelineno-44-49" name="__codelineno-44-49"></a>    <span class="c1"># initialise node</span>
<a id="__codelineno-44-50" name="__codelineno-44-50"></a>    <span class="n">rospy</span><span class="o">.</span><span class="n">init_node</span><span class="p">(</span><span class="s1">&#39;led_actuator&#39;</span><span class="p">)</span>
<a id="__codelineno-44-51" name="__codelineno-44-51"></a>    <span class="c1"># initialise class</span>
<a id="__codelineno-44-52" name="__codelineno-44-52"></a>    <span class="n">led_server</span> <span class="o">=</span> <span class="n">ledServer</span><span class="p">()</span>
<a id="__codelineno-44-53" name="__codelineno-44-53"></a>    <span class="c1"># reset leds</span>
<a id="__codelineno-44-54" name="__codelineno-44-54"></a>    <span class="n">led_server</span><span class="o">.</span><span class="n">resetLed</span><span class="p">()</span>
<a id="__codelineno-44-55" name="__codelineno-44-55"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-44-56" name="__codelineno-44-56"></a>        <span class="c1"># loop</span>
<a id="__codelineno-44-57" name="__codelineno-44-57"></a>        <span class="n">rospy</span><span class="o">.</span><span class="n">spin</span><span class="p">()</span>
<a id="__codelineno-44-58" name="__codelineno-44-58"></a>    <span class="k">except</span> <span class="n">rospy</span><span class="o">.</span><span class="n">ROSInterruptException</span><span class="p">:</span>
<a id="__codelineno-44-59" name="__codelineno-44-59"></a>        <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
<p>To test the code run
<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a>rosrun rpi_feros led_service_server.py 
</code></pre></div>
and check the list of services (look for <code>/set_led_state</code>)
<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a>rosservice list
</code></pre></div>
Use <code>rosservice call</code> to test the server
<div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a>rosservice call /set_led_state &quot;data: True&quot;
<a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a>rosservice call /set_led_state &quot;data: False&quot; 
</code></pre></div></p>
<h2 id="client">Client</h2>
<p>Syntax for service proxy (client):
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-48-1">1</a></span>
<span class="normal"><a href="#__codelineno-48-2">2</a></span>
<span class="normal"><a href="#__codelineno-48-3">3</a></span>
<span class="normal"><a href="#__codelineno-48-4">4</a></span>
<span class="normal"><a href="#__codelineno-48-5">5</a></span>
<span class="normal"><a href="#__codelineno-48-6">6</a></span>
<span class="normal"><a href="#__codelineno-48-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1"></a><span class="n">rospy</span><span class="o">.</span><span class="n">wait_for_service</span><span class="p">(</span><span class="s1">&#39;/service_name&#39;</span><span class="p">)</span>
<a id="__codelineno-48-2" name="__codelineno-48-2"></a>
<a id="__codelineno-48-3" name="__codelineno-48-3"></a><span class="k">try</span><span class="p">:</span>
<a id="__codelineno-48-4" name="__codelineno-48-4"></a>  <span class="n">client</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">ServiceProxy</span><span class="p">(</span><span class="s1">&#39;/service_name&#39;</span><span class="p">,</span><span class="n">msg_type</span><span class="p">)</span>
<a id="__codelineno-48-5" name="__codelineno-48-5"></a>  <span class="o">...</span>
<a id="__codelineno-48-6" name="__codelineno-48-6"></a><span class="k">except</span> <span class="n">rospy</span><span class="o">.</span><span class="n">ServiceException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-48-7" name="__codelineno-48-7"></a>  <span class="n">rospy</span><span class="o">.</span><span class="n">logwarn</span><span class="p">(</span><span class="s1">&#39;Service failed&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</code></pre></div></td></tr></table></div></p>
<p>Example:
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">button_service_client.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-49-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-49-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-49-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-49-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-49-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-49-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-49-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-49-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-49-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-49-10">10</a></span>
<span class="normal"><a href="#__codelineno-49-11">11</a></span>
<span class="normal"><a href="#__codelineno-49-12">12</a></span>
<span class="normal"><a href="#__codelineno-49-13">13</a></span>
<span class="normal"><a href="#__codelineno-49-14">14</a></span>
<span class="normal"><a href="#__codelineno-49-15">15</a></span>
<span class="normal"><a href="#__codelineno-49-16">16</a></span>
<span class="normal"><a href="#__codelineno-49-17">17</a></span>
<span class="normal"><a href="#__codelineno-49-18">18</a></span>
<span class="normal"><a href="#__codelineno-49-19">19</a></span>
<span class="normal"><a href="#__codelineno-49-20">20</a></span>
<span class="normal"><a href="#__codelineno-49-21">21</a></span>
<span class="normal"><a href="#__codelineno-49-22">22</a></span>
<span class="normal"><a href="#__codelineno-49-23">23</a></span>
<span class="normal"><a href="#__codelineno-49-24">24</a></span>
<span class="normal"><a href="#__codelineno-49-25">25</a></span>
<span class="normal"><a href="#__codelineno-49-26">26</a></span>
<span class="normal"><a href="#__codelineno-49-27">27</a></span>
<span class="normal"><a href="#__codelineno-49-28">28</a></span>
<span class="normal"><a href="#__codelineno-49-29">29</a></span>
<span class="normal"><a href="#__codelineno-49-30">30</a></span>
<span class="normal"><a href="#__codelineno-49-31">31</a></span>
<span class="normal"><a href="#__codelineno-49-32">32</a></span>
<span class="normal"><a href="#__codelineno-49-33">33</a></span>
<span class="normal"><a href="#__codelineno-49-34">34</a></span>
<span class="normal"><a href="#__codelineno-49-35">35</a></span>
<span class="normal"><a href="#__codelineno-49-36">36</a></span>
<span class="normal"><a href="#__codelineno-49-37">37</a></span>
<span class="normal"><a href="#__codelineno-49-38">38</a></span>
<span class="normal"><a href="#__codelineno-49-39">39</a></span>
<span class="normal"><a href="#__codelineno-49-40">40</a></span>
<span class="normal"><a href="#__codelineno-49-41">41</a></span>
<span class="normal"><a href="#__codelineno-49-42">42</a></span>
<span class="normal"><a href="#__codelineno-49-43">43</a></span>
<span class="normal"><a href="#__codelineno-49-44">44</a></span>
<span class="normal"><a href="#__codelineno-49-45">45</a></span>
<span class="normal"><a href="#__codelineno-49-46">46</a></span>
<span class="normal"><a href="#__codelineno-49-47">47</a></span>
<span class="normal"><a href="#__codelineno-49-48">48</a></span>
<span class="normal"><a href="#__codelineno-49-49">49</a></span>
<span class="normal"><a href="#__codelineno-49-50">50</a></span>
<span class="normal"><a href="#__codelineno-49-51">51</a></span>
<span class="normal"><a href="#__codelineno-49-52">52</a></span>
<span class="normal"><a href="#__codelineno-49-53">53</a></span>
<span class="normal"><a href="#__codelineno-49-54">54</a></span>
<span class="normal"><a href="#__codelineno-49-55">55</a></span>
<span class="normal"><a href="#__codelineno-49-56">56</a></span>
<span class="normal"><a href="#__codelineno-49-57">57</a></span>
<span class="normal"><a href="#__codelineno-49-58">58</a></span>
<span class="normal"><a href="#__codelineno-49-59">59</a></span>
<span class="normal"><a href="#__codelineno-49-60">60</a></span>
<span class="normal"><a href="#__codelineno-49-61">61</a></span>
<span class="normal"><a href="#__codelineno-49-62">62</a></span>
<span class="normal"><a href="#__codelineno-49-63">63</a></span>
<span class="normal"><a href="#__codelineno-49-64">64</a></span>
<span class="normal"><a href="#__codelineno-49-65">65</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1"></a><span class="ch">#!/usr/bin/env python</span>
<a id="__codelineno-49-2" name="__codelineno-49-2"></a>
<a id="__codelineno-49-3" name="__codelineno-49-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rospy</span>
<a id="__codelineno-49-4" name="__codelineno-49-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">std_srvs.srv</span><span class="w"> </span><span class="kn">import</span> <span class="n">SetBool</span>
<a id="__codelineno-49-5" name="__codelineno-49-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">RPi.GPIO</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">GPIO</span>
<a id="__codelineno-49-6" name="__codelineno-49-6"></a>
<a id="__codelineno-49-7" name="__codelineno-49-7"></a><span class="k">class</span><span class="w"> </span><span class="nc">buttonClient</span><span class="p">():</span>
<a id="__codelineno-49-8" name="__codelineno-49-8"></a>
<a id="__codelineno-49-9" name="__codelineno-49-9"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-49-10" name="__codelineno-49-10"></a>        <span class="c1"># init variables</span>
<a id="__codelineno-49-11" name="__codelineno-49-11"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">BUTTON_GPIO</span> <span class="o">=</span> <span class="mi">11</span>
<a id="__codelineno-49-12" name="__codelineno-49-12"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">LED_STATE</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-49-13" name="__codelineno-49-13"></a>        <span class="c1"># set GPIO kot BCM</span>
<a id="__codelineno-49-14" name="__codelineno-49-14"></a>        <span class="n">GPIO</span><span class="o">.</span><span class="n">setmode</span><span class="p">(</span><span class="n">GPIO</span><span class="o">.</span><span class="n">BCM</span><span class="p">)</span>
<a id="__codelineno-49-15" name="__codelineno-49-15"></a>        <span class="c1"># set button GPIO as input</span>
<a id="__codelineno-49-16" name="__codelineno-49-16"></a>        <span class="n">GPIO</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">BUTTON_GPIO</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">IN</span><span class="p">)</span>
<a id="__codelineno-49-17" name="__codelineno-49-17"></a>        <span class="c1"># set interrupt</span>
<a id="__codelineno-49-18" name="__codelineno-49-18"></a>        <span class="c1"># GPIO.add_event_detect(gpio_num, edge, callback, bouncetime)</span>
<a id="__codelineno-49-19" name="__codelineno-49-19"></a>        <span class="n">GPIO</span><span class="o">.</span><span class="n">add_event_detect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">BUTTON_GPIO</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">RISING</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">button_callback</span><span class="p">,</span> <span class="n">bouncetime</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
<a id="__codelineno-49-20" name="__codelineno-49-20"></a>
<a id="__codelineno-49-21" name="__codelineno-49-21"></a>        <span class="c1"># define service proxy</span>
<a id="__codelineno-49-22" name="__codelineno-49-22"></a>        <span class="c1"># rospy.ServiceProxy(&#39;service_name&#39;, varType)</span>
<a id="__codelineno-49-23" name="__codelineno-49-23"></a>        <span class="c1"># wait for service</span>
<a id="__codelineno-49-24" name="__codelineno-49-24"></a>        <span class="n">rospy</span><span class="o">.</span><span class="n">wait_for_service</span><span class="p">(</span><span class="s1">&#39;/set_led_state&#39;</span><span class="p">)</span>
<a id="__codelineno-49-25" name="__codelineno-49-25"></a>        <span class="c1"># define proxy </span>
<a id="__codelineno-49-26" name="__codelineno-49-26"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_led_state</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">ServiceProxy</span><span class="p">(</span><span class="s1">&#39;/set_led_state&#39;</span><span class="p">,</span> <span class="n">SetBool</span><span class="p">)</span>
<a id="__codelineno-49-27" name="__codelineno-49-27"></a>
<a id="__codelineno-49-28" name="__codelineno-49-28"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl_c</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-49-29" name="__codelineno-49-29"></a>        <span class="n">rospy</span><span class="o">.</span><span class="n">on_shutdown</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shutdownhook</span><span class="p">)</span>
<a id="__codelineno-49-30" name="__codelineno-49-30"></a>
<a id="__codelineno-49-31" name="__codelineno-49-31"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">button_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="p">):</span>
<a id="__codelineno-49-32" name="__codelineno-49-32"></a>        <span class="c1"># code that is called from interrupt</span>
<a id="__codelineno-49-33" name="__codelineno-49-33"></a>        <span class="c1"># get the button state</span>
<a id="__codelineno-49-34" name="__codelineno-49-34"></a>        <span class="n">power_on_led</span> <span class="o">=</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">BUTTON_GPIO</span><span class="p">)</span>
<a id="__codelineno-49-35" name="__codelineno-49-35"></a>
<a id="__codelineno-49-36" name="__codelineno-49-36"></a>        <span class="c1"># change LED state</span>
<a id="__codelineno-49-37" name="__codelineno-49-37"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">LED_STATE</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">LED_STATE</span>
<a id="__codelineno-49-38" name="__codelineno-49-38"></a>
<a id="__codelineno-49-39" name="__codelineno-49-39"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-49-40" name="__codelineno-49-40"></a>            <span class="c1"># send request, get response</span>
<a id="__codelineno-49-41" name="__codelineno-49-41"></a>            <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_led_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">LED_STATE</span><span class="p">)</span>
<a id="__codelineno-49-42" name="__codelineno-49-42"></a>            <span class="c1"># print response</span>
<a id="__codelineno-49-43" name="__codelineno-49-43"></a>            <span class="nb">print</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
<a id="__codelineno-49-44" name="__codelineno-49-44"></a>        <span class="k">except</span> <span class="n">rospy</span><span class="o">.</span><span class="n">ServiceException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-49-45" name="__codelineno-49-45"></a>            <span class="c1"># in case of error</span>
<a id="__codelineno-49-46" name="__codelineno-49-46"></a>            <span class="n">rospy</span><span class="o">.</span><span class="n">logwarn</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<a id="__codelineno-49-47" name="__codelineno-49-47"></a>
<a id="__codelineno-49-48" name="__codelineno-49-48"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">shutdownhook</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-49-49" name="__codelineno-49-49"></a>        <span class="c1"># works better than the rospy.is_shutdown()</span>
<a id="__codelineno-49-50" name="__codelineno-49-50"></a>        <span class="c1"># this code is run at ctrl + c</span>
<a id="__codelineno-49-51" name="__codelineno-49-51"></a>
<a id="__codelineno-49-52" name="__codelineno-49-52"></a>        <span class="c1"># clear all settings</span>
<a id="__codelineno-49-53" name="__codelineno-49-53"></a>        <span class="n">GPIO</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
<a id="__codelineno-49-54" name="__codelineno-49-54"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl_c</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-49-55" name="__codelineno-49-55"></a>
<a id="__codelineno-49-56" name="__codelineno-49-56"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<a id="__codelineno-49-57" name="__codelineno-49-57"></a>    <span class="c1"># initialise node</span>
<a id="__codelineno-49-58" name="__codelineno-49-58"></a>    <span class="n">rospy</span><span class="o">.</span><span class="n">init_node</span><span class="p">(</span><span class="s1">&#39;button_monitor&#39;</span><span class="p">)</span>
<a id="__codelineno-49-59" name="__codelineno-49-59"></a>    <span class="c1"># initialise class</span>
<a id="__codelineno-49-60" name="__codelineno-49-60"></a>    <span class="n">button_client</span> <span class="o">=</span> <span class="n">buttonClient</span><span class="p">()</span>
<a id="__codelineno-49-61" name="__codelineno-49-61"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-49-62" name="__codelineno-49-62"></a>        <span class="c1"># loop</span>
<a id="__codelineno-49-63" name="__codelineno-49-63"></a>        <span class="n">rospy</span><span class="o">.</span><span class="n">spin</span><span class="p">()</span>
<a id="__codelineno-49-64" name="__codelineno-49-64"></a>    <span class="k">except</span> <span class="n">rospy</span><span class="o">.</span><span class="n">ROSInterruptException</span><span class="p">:</span>
<a id="__codelineno-49-65" name="__codelineno-49-65"></a>        <span class="k">pass</span>
</code></pre></div></td></tr></table></div></p>
<p>To test, run both server and client in seperate terminals
<div class="highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a>rosrun rpi_feros led_service_server.py 
<a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a>rosrun rpi_feros button_service_client.py
</code></pre></div>
With a button press, LED should turn on and off.</p>
<h2 id="debug_2">DEBUG</h2>
<ul>
<li><code>rosservice list</code> - list of all active services</li>
<li><code>rosservice info &lt;service name&gt;</code> - information about the selected service</li>
<li><code>rosservice call &lt;service name&gt;</code> - request to service server from the console</li>
</ul>
<h2 id="exercise_2">Exercise</h2>
<p>Use buttons to shift active LED left or right.</p>
<p><img alt="Use buttons to shift active LED left or right." src="../images/service_2.png" title="Use buttons to shift active LED left or right." /></p>
<h1 id="custom-messages">Custom messages</h1>
<p>Topics messages: <code>.msg</code></p>
<p>Service messages: <code>.srv</code></p>
<p>Service message has two parts
<div class="highlight"><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a>Request msg
<a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a>---
<a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a>Response msg
</code></pre></div></p>
<p>Use of <code>msg</code> primitives to define custom messages.</p>
<p>MSG:</p>
<ul>
<li>std_msgs</li>
<li>sensor_msgs</li>
<li>geometry_msgs</li>
<li>actionlib_msgs</li>
<li>...</li>
</ul>
<p>SRV:</p>
<ul>
<li>std_srvs</li>
<li>...</li>
</ul>
<h2 id="msg">MSG</h2>
<p>We will create new topic message <code>ledStatus</code> composed of
<div class="highlight"><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a>int64 ledNumber
<a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a>string ledStatus
</code></pre></div>
Create new package <code>rpi_msgs</code>
<div class="highlight"><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a>cd ~/catkin_ws/src
<a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a>catkin_create_pkg rpi_msgs rospy std_msgs
</code></pre></div>
and build it
<div class="highlight"><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a>roscd
<a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a>cd ..
<a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a>catkin_make
</code></pre></div>
Go to the package and create new folder <code>msg</code>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a>roscd rpi_msgs
<a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a>mkdir msg
<a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a>cd msg
</code></pre></div></p>
<p>Create new file <code>ledStatus.msg</code>
<div class="highlight"><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a>touch ledStatus.msg
<a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a>code ledStatus.msg
</code></pre></div>
and copy the following lines:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-57-1">1</a></span>
<span class="normal"><a href="#__codelineno-57-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1"></a>int64 ledNumber
<a id="__codelineno-57-2" name="__codelineno-57-2"></a>string ledStatus
</code></pre></div></td></tr></table></div></p>
<p>Open <code>package.xml</code> in <code>rpi_msgs</code> package
<div class="highlight"><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a>code package.xml
</code></pre></div>
and add the following lines
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">package.xml</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-59-58">58</a></span>
<span class="normal"><a href="#__codelineno-59-59">59</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-59-58" name="__codelineno-59-58"></a><span class="nt">&lt;build_depend&gt;</span>message_generation<span class="nt">&lt;/build_depend&gt;</span>
<a id="__codelineno-59-59" name="__codelineno-59-59"></a><span class="nt">&lt;exec_depend&gt;</span>message_runtime<span class="nt">&lt;/exec_depend&gt;</span>
</code></pre></div></td></tr></table></div></p>
<p>Open <code>CMakeLists.txt</code> in <code>rpi_msgs</code> package
<div class="highlight"><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a>code CMakeLists.txt
</code></pre></div>
and add the following lines
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">CMakeLists.txt</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-61-10">10</a></span>
<span class="normal"><a href="#__codelineno-61-11">11</a></span>
<span class="normal"><a href="#__codelineno-61-12">12</a></span>
<span class="normal"><a href="#__codelineno-61-13">13</a></span>
<span class="normal"><a href="#__codelineno-61-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-61-10" name="__codelineno-61-10"></a>find_package(catkin REQUIRED COMPONENTS
<a id="__codelineno-61-11" name="__codelineno-61-11"></a>  rospy
<a id="__codelineno-61-12" name="__codelineno-61-12"></a>  std_msgs
<a id="__codelineno-61-13" name="__codelineno-61-13"></a><span class="hll">  message_generation
</span><a id="__codelineno-61-14" name="__codelineno-61-14"></a>)
</code></pre></div></td></tr></table></div></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">CMakeLists.txt</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-62-49">49</a></span>
<span class="normal"><a href="#__codelineno-62-50">50</a></span>
<span class="normal"><a href="#__codelineno-62-51">51</a></span>
<span class="normal"><a href="#__codelineno-62-52">52</a></span>
<span class="normal"><a href="#__codelineno-62-53">53</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-62-49" name="__codelineno-62-49"></a># Generate messages in the &#39;msg&#39; folder
<a id="__codelineno-62-50" name="__codelineno-62-50"></a>add_message_files(
<a id="__codelineno-62-51" name="__codelineno-62-51"></a>  FILES
<a id="__codelineno-62-52" name="__codelineno-62-52"></a><span class="hll">  ledStatus.msg
</span><a id="__codelineno-62-53" name="__codelineno-62-53"></a>)
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">CMakeLists.txt</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-63-69">69</a></span>
<span class="normal"><a href="#__codelineno-63-70">70</a></span>
<span class="normal"><a href="#__codelineno-63-71">71</a></span>
<span class="normal"><a href="#__codelineno-63-72">72</a></span>
<span class="normal"><a href="#__codelineno-63-73">73</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-63-69" name="__codelineno-63-69"></a># Generate added messages and services with any dependencies listed here
<a id="__codelineno-63-70" name="__codelineno-63-70"></a>generate_messages(
<a id="__codelineno-63-71" name="__codelineno-63-71"></a>  DEPENDENCIES
<a id="__codelineno-63-72" name="__codelineno-63-72"></a>  std_msgs
<a id="__codelineno-63-73" name="__codelineno-63-73"></a>)
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">CMakeLists.txt</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-64-104">104</a></span>
<span class="normal"><a href="#__codelineno-64-105">105</a></span>
<span class="normal"><a href="#__codelineno-64-106">106</a></span>
<span class="normal"><a href="#__codelineno-64-107">107</a></span>
<span class="normal"><a href="#__codelineno-64-108">108</a></span>
<span class="normal"><a href="#__codelineno-64-109">109</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-64-104" name="__codelineno-64-104"></a>catkin_package(
<a id="__codelineno-64-105" name="__codelineno-64-105"></a>  # INCLUDE_DIRS include
<a id="__codelineno-64-106" name="__codelineno-64-106"></a>  # LIBRARIES my_robot_msgs
<a id="__codelineno-64-107" name="__codelineno-64-107"></a><span class="hll">  CATKIN_DEPENDS rospy std_msgs message_runtime
</span><a id="__codelineno-64-108" name="__codelineno-64-108"></a>  # DEPENDS system_lib
<a id="__codelineno-64-109" name="__codelineno-64-109"></a>)
</code></pre></div></td></tr></table></div>
<p>After that do <code>catkin_make</code>
<div class="highlight"><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a>roscd
<a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a>cd ..
<a id="__codelineno-65-3" name="__codelineno-65-3" href="#__codelineno-65-3"></a>catkin_make
</code></pre></div></p>
<p>After the build is finish you can check if the message <code>rpi_msgs/ledStatus</code> is available
<div class="highlight"><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a>rosmsg list |grep rpi
</code></pre></div></p>
<h2 id="srv">SRV</h2>
<p>We will create new service message <code>safetyZone.srv</code> composed of
<div class="highlight"><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a>int16 zone
<a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a>---
<a id="__codelineno-67-3" name="__codelineno-67-3" href="#__codelineno-67-3"></a>bool success
<a id="__codelineno-67-4" name="__codelineno-67-4" href="#__codelineno-67-4"></a>string message
</code></pre></div></p>
<p>Go to the package <code>rpi_msgs</code>
<div class="highlight"><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a>roscd rpi_msgs
</code></pre></div>
and create new folder <code>srv</code>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a>mkdir srv
<a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a>cd msg
</code></pre></div></p>
<p>Create new file <code>safetyZone.srv</code>
<div class="highlight"><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a>touch safetyZone.srv
<a id="__codelineno-70-2" name="__codelineno-70-2" href="#__codelineno-70-2"></a>code safetyZone.srv
</code></pre></div>
and copy the following lines:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-71-1">1</a></span>
<span class="normal"><a href="#__codelineno-71-2">2</a></span>
<span class="normal"><a href="#__codelineno-71-3">3</a></span>
<span class="normal"><a href="#__codelineno-71-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-71-1" name="__codelineno-71-1"></a>int16 zone
<a id="__codelineno-71-2" name="__codelineno-71-2"></a>---
<a id="__codelineno-71-3" name="__codelineno-71-3"></a>bool success
<a id="__codelineno-71-4" name="__codelineno-71-4"></a>string message
</code></pre></div></td></tr></table></div></p>
<p>Open <code>CMakeLists.txt</code> in <code>rpi_msgs</code> package
<div class="highlight"><pre><span></span><code><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a>code CMakeLists.txt
</code></pre></div>
and add the following lines
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">CMakeLists.txt</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-73-55">55</a></span>
<span class="normal"><a href="#__codelineno-73-56">56</a></span>
<span class="normal"><a href="#__codelineno-73-57">57</a></span>
<span class="normal"><a href="#__codelineno-73-58">58</a></span>
<span class="normal"><a href="#__codelineno-73-59">59</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-73-55" name="__codelineno-73-55"></a># Generate services in the &#39;srv&#39; folder
<a id="__codelineno-73-56" name="__codelineno-73-56"></a>add_service_files(
<a id="__codelineno-73-57" name="__codelineno-73-57"></a>  FILES
<a id="__codelineno-73-58" name="__codelineno-73-58"></a><span class="hll">  safetyZone.srv
</span><a id="__codelineno-73-59" name="__codelineno-73-59"></a>)
</code></pre></div></td></tr></table></div></p>
<p>After that do the <code>catkin_make</code>
<div class="highlight"><pre><span></span><code><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a>roscd
<a id="__codelineno-74-2" name="__codelineno-74-2" href="#__codelineno-74-2"></a>cd ..
<a id="__codelineno-74-3" name="__codelineno-74-3" href="#__codelineno-74-3"></a>catkin_make
</code></pre></div></p>
<p>After the build is finish you can check if the service message <code>rpi_msgs/safetyZone</code> is available
<div class="highlight"><pre><span></span><code><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a>rossrv list |grep rpi
</code></pre></div></p>
<h2 id="use-of-custom-msg-and-srv">Use of custom MSG and SRV</h2>
<p>To use custom messages, you need to do some changes of the <code>package.html</code> and the <code>CMakeLists.txt</code> of the package where you want to use them (in our case <code>rpi_feros</code>)</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">package.html</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-76-61">61</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-76-61" name="__codelineno-76-61"></a><span class="nt">&lt;depend&gt;</span>rpi_msgs<span class="nt">&lt;/depend&gt;</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">CMakeLists.txt</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-77-10">10</a></span>
<span class="normal"><a href="#__codelineno-77-11">11</a></span>
<span class="normal"><a href="#__codelineno-77-12">12</a></span>
<span class="normal"><a href="#__codelineno-77-13">13</a></span>
<span class="normal"><a href="#__codelineno-77-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-77-10" name="__codelineno-77-10"></a>find_package(catkin REQUIRED COMPONENTS
<a id="__codelineno-77-11" name="__codelineno-77-11"></a>  rospy
<a id="__codelineno-77-12" name="__codelineno-77-12"></a>  std_msgs
<a id="__codelineno-77-13" name="__codelineno-77-13"></a>  rpi_msgs
<a id="__codelineno-77-14" name="__codelineno-77-14"></a>)
</code></pre></div></td></tr></table></div>
<p>To include new message in python code add
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-78-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-78-3" name="__codelineno-78-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">rpi_msgs.msg</span><span class="w"> </span><span class="kn">import</span> <span class="n">ledStatus</span><span class="p">,</span> <span class="n">safetyZone</span>
</code></pre></div></td></tr></table></div></p>
<h2 id="debug_3">DEBUG</h2>
<ul>
<li><code>rosmsg list</code> - list of available messages</li>
<li>
<p><code>rosmsg show &lt;msg name&gt;</code> - show message details</p>
</li>
<li>
<p><code>rossrv list</code> - list of available service messages</p>
</li>
<li><code>rossrv show &lt;srv msg name&gt;</code> - show service message details</li>
</ul>
<h2 id="exercise_3">Exercise</h2>
<p>Turn on LEDs regarding to distance <span class="arithmatex">\(d\)</span> from safety sensor:</p>
<ul>
<li>green: <span class="arithmatex">\(d\)</span> &gt; 0.4 m</li>
<li>yellow: 0.4 m &gt; <span class="arithmatex">\(d\)</span> &gt; 0.2 m</li>
<li>red: <span class="arithmatex">\(d\)</span> &lt; 0.2 m</li>
</ul>
<p><img alt="Turn on LEDs regarding to distance d." src="../images/msgs_2.png" title="Turn on LEDs regarding to distance d." /></p>
<h1 id="actions">Actions</h1>
<ul>
<li><code>actionlib</code> library</li>
<li>server/client system</li>
<li>asynchronous operation</li>
<li>used for longer lasting functionalities</li>
<li>you can perform other tasks while basic functionality is called</li>
<li>action msg is composed of individual messages for Goal, Feedback and Result</li>
</ul>
<p>How to recognise action?</p>
<p>Use <code>rostopic list</code> and look for the following structure (<code>as</code> stands for <code>action server</code>):
<div class="highlight"><pre><span></span><code><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a>as_name/cancel
<a id="__codelineno-79-2" name="__codelineno-79-2" href="#__codelineno-79-2"></a>as_name/feedback
<a id="__codelineno-79-3" name="__codelineno-79-3" href="#__codelineno-79-3"></a>as_name/goal
<a id="__codelineno-79-4" name="__codelineno-79-4" href="#__codelineno-79-4"></a>as_name/result
<a id="__codelineno-79-5" name="__codelineno-79-5" href="#__codelineno-79-5"></a>as_name/status
</code></pre></div>
(<code>as_name</code> is action server namespace).</p>
<h2 id="action-msg">Action MSG</h2>
<p>Action msgs can be defined in package <code>rpi_msgs</code>. Create new folder <code>action</code> and inside new file <code>runningLed.action</code>.
<div class="highlight"><pre><span></span><code><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a>roscd rpi_msgs
<a id="__codelineno-80-2" name="__codelineno-80-2" href="#__codelineno-80-2"></a>mkdir action
<a id="__codelineno-80-3" name="__codelineno-80-3" href="#__codelineno-80-3"></a>cd ./action
<a id="__codelineno-80-4" name="__codelineno-80-4" href="#__codelineno-80-4"></a>touch runningLed.action
<a id="__codelineno-80-5" name="__codelineno-80-5" href="#__codelineno-80-5"></a>code runnngLed.action
</code></pre></div>
Copy the following acton msg definition:
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">runningLed.action</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-81-1">1</a></span>
<span class="normal"><a href="#__codelineno-81-2">2</a></span>
<span class="normal"><a href="#__codelineno-81-3">3</a></span>
<span class="normal"><a href="#__codelineno-81-4">4</a></span>
<span class="normal"><a href="#__codelineno-81-5">5</a></span>
<span class="normal"><a href="#__codelineno-81-6">6</a></span>
<span class="normal"><a href="#__codelineno-81-7">7</a></span>
<span class="normal"><a href="#__codelineno-81-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-81-1" name="__codelineno-81-1"></a># goal
<a id="__codelineno-81-2" name="__codelineno-81-2"></a>int16 numberOfRuns
<a id="__codelineno-81-3" name="__codelineno-81-3"></a>---
<a id="__codelineno-81-4" name="__codelineno-81-4"></a># result
<a id="__codelineno-81-5" name="__codelineno-81-5"></a>int16 finalRun
<a id="__codelineno-81-6" name="__codelineno-81-6"></a>---
<a id="__codelineno-81-7" name="__codelineno-81-7"></a># feedback
<a id="__codelineno-81-8" name="__codelineno-81-8"></a>int16 currentRun
</code></pre></div></td></tr></table></div></p>
<p>In <code>CMakeLists.txt</code> of the <code>rpi_msgs</code> package change the following lines:</p>
<p><div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">CMakeLists.txt</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-82-10">10</a></span>
<span class="normal"><a href="#__codelineno-82-11">11</a></span>
<span class="normal"><a href="#__codelineno-82-12">12</a></span>
<span class="normal"><a href="#__codelineno-82-13">13</a></span>
<span class="normal"><a href="#__codelineno-82-14">14</a></span>
<span class="normal"><a href="#__codelineno-82-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-82-10" name="__codelineno-82-10"></a>find_package(catkin REQUIRED COMPONENTS
<a id="__codelineno-82-11" name="__codelineno-82-11"></a>  rospy
<a id="__codelineno-82-12" name="__codelineno-82-12"></a>  std_msgs
<a id="__codelineno-82-13" name="__codelineno-82-13"></a>  message_generation
<a id="__codelineno-82-14" name="__codelineno-82-14"></a><span class="hll">  actionlib_msgs
</span><a id="__codelineno-82-15" name="__codelineno-82-15"></a>)
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">CMakeLists.txt</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-83-62">62</a></span>
<span class="normal"><a href="#__codelineno-83-63">63</a></span>
<span class="normal"><a href="#__codelineno-83-64">64</a></span>
<span class="normal"><a href="#__codelineno-83-65">65</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-83-62" name="__codelineno-83-62"></a>add_action_files(
<a id="__codelineno-83-63" name="__codelineno-83-63"></a>  FILES
<a id="__codelineno-83-64" name="__codelineno-83-64"></a>  runningLed.action
<a id="__codelineno-83-65" name="__codelineno-83-65"></a>)
</code></pre></div></td></tr></table></div></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">CMakeLists.txt</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-84-69">69</a></span>
<span class="normal"><a href="#__codelineno-84-70">70</a></span>
<span class="normal"><a href="#__codelineno-84-71">71</a></span>
<span class="normal"><a href="#__codelineno-84-72">72</a></span>
<span class="normal"><a href="#__codelineno-84-73">73</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-84-69" name="__codelineno-84-69"></a>generate_messages(
<a id="__codelineno-84-70" name="__codelineno-84-70"></a>  DEPENDENCIES
<a id="__codelineno-84-71" name="__codelineno-84-71"></a>  std_msgs
<a id="__codelineno-84-72" name="__codelineno-84-72"></a><span class="hll">  actionlib_msgs
</span><a id="__codelineno-84-73" name="__codelineno-84-73"></a>)
</code></pre></div></td></tr></table></div>
<p>In <code>package.xml</code> of the <code>rpi_msgs</code> package add the following line:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">package.xml</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-85-60">60</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-85-60" name="__codelineno-85-60"></a><span class="nt">&lt;build_depend&gt;</span>actionlib_msgs<span class="nt">&lt;/build_depend&gt;</span>
</code></pre></div></td></tr></table></div>
<p>Then do <code>catkin_make</code> in <code>catkin_ws</code> folder.</p>
<h2 id="example_2">Example</h2>
<p>Turn on sequential LEDs n-times.</p>
<p><img alt="Turn on sequential LEDs n-times." src="../images/action_1.png" title="Turn on sequential LEDs n-times." /></p>
<h2 id="action-server">Action server</h2>
<p>Simple action server sytnax:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-86-1">1</a></span>
<span class="normal"><a href="#__codelineno-86-2">2</a></span>
<span class="normal"><a href="#__codelineno-86-3">3</a></span>
<span class="normal"><a href="#__codelineno-86-4">4</a></span>
<span class="normal"><a href="#__codelineno-86-5">5</a></span>
<span class="normal"><a href="#__codelineno-86-6">6</a></span>
<span class="normal"><a href="#__codelineno-86-7">7</a></span>
<span class="normal"><a href="#__codelineno-86-8">8</a></span>
<span class="normal"><a href="#__codelineno-86-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-86-1" name="__codelineno-86-1"></a><span class="n">sas</span> <span class="o">=</span> <span class="n">actionlib</span><span class="o">.</span><span class="n">SimpleActionServer</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">actionSpec</span><span class="p">,</span> <span class="n">goal_callback</span><span class="p">,</span> <span class="n">auto_start</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-86-2" name="__codelineno-86-2"></a><span class="n">sas</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<a id="__codelineno-86-3" name="__codelineno-86-3"></a>
<a id="__codelineno-86-4" name="__codelineno-86-4"></a><span class="k">def</span><span class="w"> </span><span class="nf">goal_callback</span><span class="p">()</span>
<a id="__codelineno-86-5" name="__codelineno-86-5"></a>  <span class="n">sas</span><span class="o">.</span><span class="n">publish_feedback</span><span class="p">(</span><span class="n">_feedback_</span><span class="p">)</span>
<a id="__codelineno-86-6" name="__codelineno-86-6"></a>  <span class="n">sas</span><span class="o">.</span><span class="n">set_succeeded</span><span class="p">(</span><span class="n">_result_</span><span class="p">)</span>
<a id="__codelineno-86-7" name="__codelineno-86-7"></a>
<a id="__codelineno-86-8" name="__codelineno-86-8"></a><span class="k">if</span> <span class="n">sas</span><span class="o">.</span><span class="n">is_preempt_requested</span><span class="p">():</span>
<a id="__codelineno-86-9" name="__codelineno-86-9"></a>  <span class="n">sas</span><span class="o">.</span><span class="n">set_preempted</span><span class="p">()</span>
</code></pre></div></td></tr></table></div></p>
<p>Example code for simple action server:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">ledrun_server.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-87-1">  1</a></span>
<span class="normal"><a href="#__codelineno-87-2">  2</a></span>
<span class="normal"><a href="#__codelineno-87-3">  3</a></span>
<span class="normal"><a href="#__codelineno-87-4">  4</a></span>
<span class="normal"><a href="#__codelineno-87-5">  5</a></span>
<span class="normal"><a href="#__codelineno-87-6">  6</a></span>
<span class="normal"><a href="#__codelineno-87-7">  7</a></span>
<span class="normal"><a href="#__codelineno-87-8">  8</a></span>
<span class="normal"><a href="#__codelineno-87-9">  9</a></span>
<span class="normal"><a href="#__codelineno-87-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-87-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-87-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-87-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-87-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-87-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-87-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-87-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-87-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-87-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-87-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-87-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-87-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-87-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-87-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-87-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-87-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-87-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-87-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-87-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-87-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-87-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-87-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-87-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-87-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-87-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-87-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-87-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-87-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-87-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-87-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-87-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-87-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-87-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-87-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-87-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-87-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-87-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-87-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-87-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-87-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-87-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-87-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-87-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-87-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-87-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-87-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-87-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-87-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-87-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-87-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-87-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-87-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-87-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-87-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-87-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-87-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-87-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-87-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-87-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-87-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-87-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-87-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-87-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-87-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-87-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-87-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-87-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-87-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-87-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-87-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-87-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-87-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-87-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-87-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-87-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-87-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-87-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-87-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-87-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-87-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-87-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-87-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-87-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-87-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-87-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-87-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-87-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-87-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-87-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-87-100">100</a></span>
<span class="normal"><a href="#__codelineno-87-101">101</a></span>
<span class="normal"><a href="#__codelineno-87-102">102</a></span>
<span class="normal"><a href="#__codelineno-87-103">103</a></span>
<span class="normal"><a href="#__codelineno-87-104">104</a></span>
<span class="normal"><a href="#__codelineno-87-105">105</a></span>
<span class="normal"><a href="#__codelineno-87-106">106</a></span>
<span class="normal"><a href="#__codelineno-87-107">107</a></span>
<span class="normal"><a href="#__codelineno-87-108">108</a></span>
<span class="normal"><a href="#__codelineno-87-109">109</a></span>
<span class="normal"><a href="#__codelineno-87-110">110</a></span>
<span class="normal"><a href="#__codelineno-87-111">111</a></span>
<span class="normal"><a href="#__codelineno-87-112">112</a></span>
<span class="normal"><a href="#__codelineno-87-113">113</a></span>
<span class="normal"><a href="#__codelineno-87-114">114</a></span>
<span class="normal"><a href="#__codelineno-87-115">115</a></span>
<span class="normal"><a href="#__codelineno-87-116">116</a></span>
<span class="normal"><a href="#__codelineno-87-117">117</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-87-1" name="__codelineno-87-1"></a><span class="ch">#!/usr/bin/env python</span>
<a id="__codelineno-87-2" name="__codelineno-87-2"></a>
<a id="__codelineno-87-3" name="__codelineno-87-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rospy</span>
<a id="__codelineno-87-4" name="__codelineno-87-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">RPi.GPIO</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">GPIO</span>
<a id="__codelineno-87-5" name="__codelineno-87-5"></a><span class="c1"># include actionlib</span>
<a id="__codelineno-87-6" name="__codelineno-87-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">actionlib</span>
<a id="__codelineno-87-7" name="__codelineno-87-7"></a><span class="c1"># include action msgs</span>
<a id="__codelineno-87-8" name="__codelineno-87-8"></a><span class="kn">from</span><span class="w"> </span><span class="nn">rpi_msgs.msg</span><span class="w"> </span><span class="kn">import</span> <span class="n">runningLedFeedback</span><span class="p">,</span> <span class="n">runningLedResult</span><span class="p">,</span> <span class="n">runningLedAction</span>
<a id="__codelineno-87-9" name="__codelineno-87-9"></a>
<a id="__codelineno-87-10" name="__codelineno-87-10"></a>
<a id="__codelineno-87-11" name="__codelineno-87-11"></a><span class="k">class</span><span class="w"> </span><span class="nc">runled_server</span><span class="p">():</span>
<a id="__codelineno-87-12" name="__codelineno-87-12"></a>
<a id="__codelineno-87-13" name="__codelineno-87-13"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-87-14" name="__codelineno-87-14"></a>        <span class="c1"># init variables</span>
<a id="__codelineno-87-15" name="__codelineno-87-15"></a>
<a id="__codelineno-87-16" name="__codelineno-87-16"></a>        <span class="c1"># set GPIO kot BCM</span>
<a id="__codelineno-87-17" name="__codelineno-87-17"></a>        <span class="n">GPIO</span><span class="o">.</span><span class="n">setmode</span><span class="p">(</span><span class="n">GPIO</span><span class="o">.</span><span class="n">BCM</span><span class="p">)</span>
<a id="__codelineno-87-18" name="__codelineno-87-18"></a>        <span class="c1"># set all leds</span>
<a id="__codelineno-87-19" name="__codelineno-87-19"></a>        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">8</span><span class="p">):</span>
<a id="__codelineno-87-20" name="__codelineno-87-20"></a>            <span class="c1"># set IO as outputs</span>
<a id="__codelineno-87-21" name="__codelineno-87-21"></a>            <span class="n">GPIO</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">GPIO</span><span class="o">.</span><span class="n">OUT</span><span class="p">)</span>
<a id="__codelineno-87-22" name="__codelineno-87-22"></a>
<a id="__codelineno-87-23" name="__codelineno-87-23"></a>        <span class="c1"># define simple action server</span>
<a id="__codelineno-87-24" name="__codelineno-87-24"></a>        <span class="c1"># actionlib.SimpleActionServer(&#39;action_name&#39;, actionType, callback, autostart)</span>
<a id="__codelineno-87-25" name="__codelineno-87-25"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ACserver</span> <span class="o">=</span> <span class="n">actionlib</span><span class="o">.</span><span class="n">SimpleActionServer</span><span class="p">(</span><span class="s1">&#39;run_led&#39;</span><span class="p">,</span> <span class="n">runningLedAction</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">goal_callback</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-87-26" name="__codelineno-87-26"></a>        <span class="c1"># run server</span>
<a id="__codelineno-87-27" name="__codelineno-87-27"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ACserver</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<a id="__codelineno-87-28" name="__codelineno-87-28"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Server pripravljen&#39;</span><span class="p">)</span>
<a id="__codelineno-87-29" name="__codelineno-87-29"></a>
<a id="__codelineno-87-30" name="__codelineno-87-30"></a>        <span class="c1"># define loop frequency (6 Hz)</span>
<a id="__codelineno-87-31" name="__codelineno-87-31"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Rate</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<a id="__codelineno-87-32" name="__codelineno-87-32"></a>
<a id="__codelineno-87-33" name="__codelineno-87-33"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl_c</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-87-34" name="__codelineno-87-34"></a>        <span class="n">rospy</span><span class="o">.</span><span class="n">on_shutdown</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shutdownhook</span><span class="p">)</span>
<a id="__codelineno-87-35" name="__codelineno-87-35"></a>
<a id="__codelineno-87-36" name="__codelineno-87-36"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">goal_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">goal</span><span class="p">):</span>
<a id="__codelineno-87-37" name="__codelineno-87-37"></a>
<a id="__codelineno-87-38" name="__codelineno-87-38"></a>        <span class="c1"># Do lots of awesome groundbreaking robot stuff here</span>
<a id="__codelineno-87-39" name="__codelineno-87-39"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">resetLed</span><span class="p">()</span>
<a id="__codelineno-87-40" name="__codelineno-87-40"></a>
<a id="__codelineno-87-41" name="__codelineno-87-41"></a>        <span class="c1"># print number of iterations </span>
<a id="__codelineno-87-42" name="__codelineno-87-42"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Stevilo iteracij: </span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">goal</span><span class="o">.</span><span class="n">numberOfRuns</span><span class="p">)</span>
<a id="__codelineno-87-43" name="__codelineno-87-43"></a>
<a id="__codelineno-87-44" name="__codelineno-87-44"></a>        <span class="c1"># define feedback variable</span>
<a id="__codelineno-87-45" name="__codelineno-87-45"></a>        <span class="n">feedback1</span> <span class="o">=</span> <span class="n">runningLedFeedback</span><span class="p">()</span>
<a id="__codelineno-87-46" name="__codelineno-87-46"></a>        <span class="c1"># define result variable</span>
<a id="__codelineno-87-47" name="__codelineno-87-47"></a>        <span class="n">result1</span> <span class="o">=</span> <span class="n">runningLedResult</span><span class="p">()</span>
<a id="__codelineno-87-48" name="__codelineno-87-48"></a>
<a id="__codelineno-87-49" name="__codelineno-87-49"></a>        <span class="n">success</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-87-50" name="__codelineno-87-50"></a>        <span class="n">doPreemt</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-87-51" name="__codelineno-87-51"></a>        <span class="c1"># do number of iterations</span>
<a id="__codelineno-87-52" name="__codelineno-87-52"></a>        <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">goal</span><span class="o">.</span><span class="n">numberOfRuns</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-87-53" name="__codelineno-87-53"></a>            <span class="c1"># turn on individual LED (GPIO 2 - GPIO 7)</span>
<a id="__codelineno-87-54" name="__codelineno-87-54"></a>            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">8</span><span class="p">):</span>
<a id="__codelineno-87-55" name="__codelineno-87-55"></a>                <span class="c1"># check if there was a preemt request</span>
<a id="__codelineno-87-56" name="__codelineno-87-56"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ACserver</span><span class="o">.</span><span class="n">is_preempt_requested</span><span class="p">():</span>
<a id="__codelineno-87-57" name="__codelineno-87-57"></a>                    <span class="c1"># skip other interations</span>
<a id="__codelineno-87-58" name="__codelineno-87-58"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Goal preempted.&#39;</span><span class="p">)</span>
<a id="__codelineno-87-59" name="__codelineno-87-59"></a>                    <span class="c1"># definie result</span>
<a id="__codelineno-87-60" name="__codelineno-87-60"></a>                    <span class="n">result1</span><span class="o">.</span><span class="n">finalRun</span> <span class="o">=</span> <span class="n">kk</span>
<a id="__codelineno-87-61" name="__codelineno-87-61"></a>                    <span class="c1"># in case of preemt send result and text</span>
<a id="__codelineno-87-62" name="__codelineno-87-62"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">ACserver</span><span class="o">.</span><span class="n">set_preempted</span><span class="p">(</span><span class="n">result</span><span class="o">=</span><span class="n">result1</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;Goal preemted.&#39;</span><span class="p">)</span>
<a id="__codelineno-87-63" name="__codelineno-87-63"></a>                    <span class="n">success</span> <span class="o">=</span> <span class="kc">False</span> 
<a id="__codelineno-87-64" name="__codelineno-87-64"></a>                    <span class="n">doPreemt</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-87-65" name="__codelineno-87-65"></a>                    <span class="c1"># break inside loop - turning on individual LEDs</span>
<a id="__codelineno-87-66" name="__codelineno-87-66"></a>                    <span class="k">break</span>
<a id="__codelineno-87-67" name="__codelineno-87-67"></a>                <span class="c1">###############################</span>
<a id="__codelineno-87-68" name="__codelineno-87-68"></a>                <span class="c1"># ACTIONS</span>
<a id="__codelineno-87-69" name="__codelineno-87-69"></a>                <span class="c1"># clear all LED</span>
<a id="__codelineno-87-70" name="__codelineno-87-70"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">resetLed</span><span class="p">()</span>
<a id="__codelineno-87-71" name="__codelineno-87-71"></a>                <span class="c1"># turn on LED i</span>
<a id="__codelineno-87-72" name="__codelineno-87-72"></a>                <span class="n">GPIO</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-87-73" name="__codelineno-87-73"></a>                <span class="c1"># 6 Hz</span>
<a id="__codelineno-87-74" name="__codelineno-87-74"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">sleep</span><span class="p">()</span>
<a id="__codelineno-87-75" name="__codelineno-87-75"></a>                <span class="c1">############################### </span>
<a id="__codelineno-87-76" name="__codelineno-87-76"></a>            <span class="c1"># in case of preemt, break outside loop - iterations</span>
<a id="__codelineno-87-77" name="__codelineno-87-77"></a>            <span class="k">if</span> <span class="n">doPreemt</span><span class="p">:</span>
<a id="__codelineno-87-78" name="__codelineno-87-78"></a>                <span class="k">break</span>
<a id="__codelineno-87-79" name="__codelineno-87-79"></a>            <span class="c1"># send feedback after each interation</span>
<a id="__codelineno-87-80" name="__codelineno-87-80"></a>            <span class="n">feedback1</span><span class="o">.</span><span class="n">currentRun</span> <span class="o">=</span> <span class="n">kk</span>
<a id="__codelineno-87-81" name="__codelineno-87-81"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">ACserver</span><span class="o">.</span><span class="n">publish_feedback</span><span class="p">(</span><span class="n">feedback1</span><span class="p">)</span>
<a id="__codelineno-87-82" name="__codelineno-87-82"></a>
<a id="__codelineno-87-83" name="__codelineno-87-83"></a>        <span class="c1"># send result after all iterations</span>
<a id="__codelineno-87-84" name="__codelineno-87-84"></a>        <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
<a id="__codelineno-87-85" name="__codelineno-87-85"></a>            <span class="c1"># define results</span>
<a id="__codelineno-87-86" name="__codelineno-87-86"></a>            <span class="n">result1</span><span class="o">.</span><span class="n">finalRun</span> <span class="o">=</span> <span class="n">feedback1</span><span class="o">.</span><span class="n">currentRun</span>
<a id="__codelineno-87-87" name="__codelineno-87-87"></a>            <span class="c1"># log</span>
<a id="__codelineno-87-88" name="__codelineno-87-88"></a>            <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s1">&#39;Zakljuceno - Succeeded&#39;</span><span class="p">)</span> 
<a id="__codelineno-87-89" name="__codelineno-87-89"></a>            <span class="c1"># poslji rezultat</span>
<a id="__codelineno-87-90" name="__codelineno-87-90"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">ACserver</span><span class="o">.</span><span class="n">set_succeeded</span><span class="p">(</span><span class="n">result1</span><span class="p">)</span>
<a id="__codelineno-87-91" name="__codelineno-87-91"></a>
<a id="__codelineno-87-92" name="__codelineno-87-92"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">resetLed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-87-93" name="__codelineno-87-93"></a>        <span class="c1"># reset all leds</span>
<a id="__codelineno-87-94" name="__codelineno-87-94"></a>        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">8</span><span class="p">):</span>
<a id="__codelineno-87-95" name="__codelineno-87-95"></a>            <span class="c1"># turn off all leds</span>
<a id="__codelineno-87-96" name="__codelineno-87-96"></a>            <span class="n">GPIO</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-87-97" name="__codelineno-87-97"></a>
<a id="__codelineno-87-98" name="__codelineno-87-98"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">shutdownhook</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-87-99" name="__codelineno-87-99"></a>        <span class="c1"># works better than the rospy.is_shutdown()</span>
<a id="__codelineno-87-100" name="__codelineno-87-100"></a>        <span class="c1"># this code is run at ctrl + c</span>
<a id="__codelineno-87-101" name="__codelineno-87-101"></a>
<a id="__codelineno-87-102" name="__codelineno-87-102"></a>        <span class="c1"># clear all settings</span>
<a id="__codelineno-87-103" name="__codelineno-87-103"></a>        <span class="n">GPIO</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
<a id="__codelineno-87-104" name="__codelineno-87-104"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl_c</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-87-105" name="__codelineno-87-105"></a>
<a id="__codelineno-87-106" name="__codelineno-87-106"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<a id="__codelineno-87-107" name="__codelineno-87-107"></a>    <span class="c1"># initialise node</span>
<a id="__codelineno-87-108" name="__codelineno-87-108"></a>    <span class="n">rospy</span><span class="o">.</span><span class="n">init_node</span><span class="p">(</span><span class="s1">&#39;runled_server&#39;</span><span class="p">)</span>
<a id="__codelineno-87-109" name="__codelineno-87-109"></a>    <span class="c1"># initialise class</span>
<a id="__codelineno-87-110" name="__codelineno-87-110"></a>    <span class="n">runled</span> <span class="o">=</span> <span class="n">runled_server</span><span class="p">()</span>
<a id="__codelineno-87-111" name="__codelineno-87-111"></a>    <span class="c1"># reset leds</span>
<a id="__codelineno-87-112" name="__codelineno-87-112"></a>    <span class="n">runled</span><span class="o">.</span><span class="n">resetLed</span><span class="p">()</span>
<a id="__codelineno-87-113" name="__codelineno-87-113"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-87-114" name="__codelineno-87-114"></a>        <span class="c1"># loop</span>
<a id="__codelineno-87-115" name="__codelineno-87-115"></a>        <span class="n">rospy</span><span class="o">.</span><span class="n">spin</span><span class="p">()</span>
<a id="__codelineno-87-116" name="__codelineno-87-116"></a>    <span class="k">except</span> <span class="n">rospy</span><span class="o">.</span><span class="n">ROSInterruptException</span><span class="p">:</span>
<a id="__codelineno-87-117" name="__codelineno-87-117"></a>        <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
<h2 id="action-client">Action client</h2>
<p>Simple action client syntax:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-88-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-88-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-88-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-88-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-88-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-88-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-88-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-88-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-88-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-88-10">10</a></span>
<span class="normal"><a href="#__codelineno-88-11">11</a></span>
<span class="normal"><a href="#__codelineno-88-12">12</a></span>
<span class="normal"><a href="#__codelineno-88-13">13</a></span>
<span class="normal"><a href="#__codelineno-88-14">14</a></span>
<span class="normal"><a href="#__codelineno-88-15">15</a></span>
<span class="normal"><a href="#__codelineno-88-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-88-1" name="__codelineno-88-1"></a><span class="n">client</span> <span class="o">=</span> <span class="n">actionlib</span><span class="o">.</span><span class="n">SimpleActionClient</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">actionSpec</span><span class="p">)</span>
<a id="__codelineno-88-2" name="__codelineno-88-2"></a>
<a id="__codelineno-88-3" name="__codelineno-88-3"></a><span class="n">client</span><span class="o">.</span><span class="n">send_goal</span><span class="p">(</span><span class="n">goal</span><span class="p">)</span> <span class="c1"># Sends the goal to the action server.</span>
<a id="__codelineno-88-4" name="__codelineno-88-4"></a>
<a id="__codelineno-88-5" name="__codelineno-88-5"></a><span class="n">client</span><span class="o">.</span><span class="n">wait_for_result</span><span class="p">()</span> <span class="c1"># Waits for the server to finish performing the action.</span>
<a id="__codelineno-88-6" name="__codelineno-88-6"></a>
<a id="__codelineno-88-7" name="__codelineno-88-7"></a><span class="n">client</span><span class="o">.</span><span class="n">get_result</span><span class="p">()</span> <span class="c1"># Prints out the result of executing the action</span>
<a id="__codelineno-88-8" name="__codelineno-88-8"></a>
<a id="__codelineno-88-9" name="__codelineno-88-9"></a><span class="n">client</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span> <span class="c1"># Get current state of the server</span>
<a id="__codelineno-88-10" name="__codelineno-88-10"></a>
<a id="__codelineno-88-11" name="__codelineno-88-11"></a><span class="c1"># define action server status</span>
<a id="__codelineno-88-12" name="__codelineno-88-12"></a><span class="n">PENDING</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-88-13" name="__codelineno-88-13"></a><span class="n">ACTIVE</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-88-14" name="__codelineno-88-14"></a><span class="n">DONE</span> <span class="o">=</span> <span class="mi">2</span>
<a id="__codelineno-88-15" name="__codelineno-88-15"></a><span class="n">WARN</span> <span class="o">=</span> <span class="mi">3</span>
<a id="__codelineno-88-16" name="__codelineno-88-16"></a><span class="n">ERROR</span> <span class="o">=</span> <span class="mi">4</span>
</code></pre></div></td></tr></table></div></p>
<p>Example code for simple action client:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">ledrun_client.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-89-1">  1</a></span>
<span class="normal"><a href="#__codelineno-89-2">  2</a></span>
<span class="normal"><a href="#__codelineno-89-3">  3</a></span>
<span class="normal"><a href="#__codelineno-89-4">  4</a></span>
<span class="normal"><a href="#__codelineno-89-5">  5</a></span>
<span class="normal"><a href="#__codelineno-89-6">  6</a></span>
<span class="normal"><a href="#__codelineno-89-7">  7</a></span>
<span class="normal"><a href="#__codelineno-89-8">  8</a></span>
<span class="normal"><a href="#__codelineno-89-9">  9</a></span>
<span class="normal"><a href="#__codelineno-89-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-89-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-89-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-89-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-89-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-89-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-89-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-89-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-89-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-89-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-89-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-89-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-89-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-89-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-89-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-89-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-89-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-89-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-89-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-89-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-89-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-89-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-89-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-89-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-89-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-89-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-89-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-89-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-89-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-89-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-89-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-89-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-89-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-89-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-89-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-89-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-89-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-89-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-89-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-89-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-89-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-89-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-89-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-89-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-89-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-89-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-89-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-89-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-89-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-89-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-89-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-89-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-89-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-89-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-89-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-89-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-89-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-89-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-89-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-89-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-89-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-89-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-89-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-89-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-89-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-89-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-89-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-89-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-89-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-89-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-89-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-89-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-89-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-89-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-89-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-89-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-89-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-89-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-89-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-89-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-89-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-89-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-89-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-89-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-89-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-89-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-89-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-89-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-89-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-89-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-89-100">100</a></span>
<span class="normal"><a href="#__codelineno-89-101">101</a></span>
<span class="normal"><a href="#__codelineno-89-102">102</a></span>
<span class="normal"><a href="#__codelineno-89-103">103</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-89-1" name="__codelineno-89-1"></a><span class="ch">#!/usr/bin/env python</span>
<a id="__codelineno-89-2" name="__codelineno-89-2"></a>
<a id="__codelineno-89-3" name="__codelineno-89-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rospy</span>
<a id="__codelineno-89-4" name="__codelineno-89-4"></a><span class="c1"># import actionlib</span>
<a id="__codelineno-89-5" name="__codelineno-89-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">actionlib</span>
<a id="__codelineno-89-6" name="__codelineno-89-6"></a><span class="c1"># import action msgs</span>
<a id="__codelineno-89-7" name="__codelineno-89-7"></a><span class="kn">from</span><span class="w"> </span><span class="nn">rpi_msgs.msg</span><span class="w"> </span><span class="kn">import</span> <span class="n">runningLedAction</span><span class="p">,</span> <span class="n">runningLedGoal</span><span class="p">,</span> <span class="n">runningLedResult</span>
<a id="__codelineno-89-8" name="__codelineno-89-8"></a>
<a id="__codelineno-89-9" name="__codelineno-89-9"></a><span class="c1"># define action server status</span>
<a id="__codelineno-89-10" name="__codelineno-89-10"></a><span class="n">PENDING</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-89-11" name="__codelineno-89-11"></a><span class="n">ACTIVE</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-89-12" name="__codelineno-89-12"></a><span class="n">DONE</span> <span class="o">=</span> <span class="mi">2</span>
<a id="__codelineno-89-13" name="__codelineno-89-13"></a><span class="n">WARN</span> <span class="o">=</span> <span class="mi">3</span>
<a id="__codelineno-89-14" name="__codelineno-89-14"></a><span class="n">ERROR</span> <span class="o">=</span> <span class="mi">4</span>
<a id="__codelineno-89-15" name="__codelineno-89-15"></a>
<a id="__codelineno-89-16" name="__codelineno-89-16"></a><span class="k">class</span><span class="w"> </span><span class="nc">runled_client</span><span class="p">():</span>
<a id="__codelineno-89-17" name="__codelineno-89-17"></a>
<a id="__codelineno-89-18" name="__codelineno-89-18"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-89-19" name="__codelineno-89-19"></a>
<a id="__codelineno-89-20" name="__codelineno-89-20"></a>        <span class="c1"># define simple action client </span>
<a id="__codelineno-89-21" name="__codelineno-89-21"></a>        <span class="c1"># actionlib.SimpleActionClient(&#39;action:name&#39;, actionType)</span>
<a id="__codelineno-89-22" name="__codelineno-89-22"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">actionlib</span><span class="o">.</span><span class="n">SimpleActionClient</span><span class="p">(</span><span class="s1">&#39;run_led&#39;</span><span class="p">,</span> <span class="n">runningLedAction</span><span class="p">)</span>
<a id="__codelineno-89-23" name="__codelineno-89-23"></a>        <span class="c1"># wait, until server isnt active</span>
<a id="__codelineno-89-24" name="__codelineno-89-24"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">wait_for_server</span><span class="p">()</span>
<a id="__codelineno-89-25" name="__codelineno-89-25"></a>        <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s2">&quot;Server is active.&quot;</span><span class="p">)</span>
<a id="__codelineno-89-26" name="__codelineno-89-26"></a>
<a id="__codelineno-89-27" name="__codelineno-89-27"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl_c</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-89-28" name="__codelineno-89-28"></a>        <span class="n">rospy</span><span class="o">.</span><span class="n">on_shutdown</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shutdownhook</span><span class="p">)</span>
<a id="__codelineno-89-29" name="__codelineno-89-29"></a>
<a id="__codelineno-89-30" name="__codelineno-89-30"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">run_led_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">goalNum</span><span class="p">):</span>
<a id="__codelineno-89-31" name="__codelineno-89-31"></a>
<a id="__codelineno-89-32" name="__codelineno-89-32"></a>        <span class="c1"># define goal</span>
<a id="__codelineno-89-33" name="__codelineno-89-33"></a>        <span class="n">goal</span> <span class="o">=</span> <span class="n">runningLedGoal</span><span class="p">()</span>
<a id="__codelineno-89-34" name="__codelineno-89-34"></a>        <span class="n">goal</span><span class="o">.</span><span class="n">numberOfRuns</span> <span class="o">=</span> <span class="n">goalNum</span>
<a id="__codelineno-89-35" name="__codelineno-89-35"></a>
<a id="__codelineno-89-36" name="__codelineno-89-36"></a>        <span class="c1"># send goal </span>
<a id="__codelineno-89-37" name="__codelineno-89-37"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">send_goal</span><span class="p">(</span><span class="n">goal</span><span class="p">)</span>
<a id="__codelineno-89-38" name="__codelineno-89-38"></a>
<a id="__codelineno-89-39" name="__codelineno-89-39"></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<a id="__codelineno-89-40" name="__codelineno-89-40"></a><span class="sd">        ###################################</span>
<a id="__codelineno-89-41" name="__codelineno-89-41"></a><span class="sd">        # FOR PREEMT TESTING</span>
<a id="__codelineno-89-42" name="__codelineno-89-42"></a><span class="sd">        # after 3 s send new goal</span>
<a id="__codelineno-89-43" name="__codelineno-89-43"></a><span class="sd">        rospy.sleep(3)</span>
<a id="__codelineno-89-44" name="__codelineno-89-44"></a><span class="sd">        goal.numberOfRuns = 2</span>
<a id="__codelineno-89-45" name="__codelineno-89-45"></a><span class="sd">        self.client.send_goal(goal) </span>
<a id="__codelineno-89-46" name="__codelineno-89-46"></a><span class="sd">        print(&#39;New goal was sent.&#39;)</span>
<a id="__codelineno-89-47" name="__codelineno-89-47"></a><span class="sd">        ###################################</span>
<a id="__codelineno-89-48" name="__codelineno-89-48"></a><span class="sd">        &#39;&#39;&#39;</span>
<a id="__codelineno-89-49" name="__codelineno-89-49"></a>
<a id="__codelineno-89-50" name="__codelineno-89-50"></a>        <span class="c1"># OPTION A - wait, until server doesn finish (similar to service)</span>
<a id="__codelineno-89-51" name="__codelineno-89-51"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">wait_for_result</span><span class="p">()</span>
<a id="__codelineno-89-52" name="__codelineno-89-52"></a>
<a id="__codelineno-89-53" name="__codelineno-89-53"></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<a id="__codelineno-89-54" name="__codelineno-89-54"></a><span class="sd">        # OPTION B - do something else while you are waiting    </span>
<a id="__codelineno-89-55" name="__codelineno-89-55"></a>
<a id="__codelineno-89-56" name="__codelineno-89-56"></a><span class="sd">        ## read current server state</span>
<a id="__codelineno-89-57" name="__codelineno-89-57"></a><span class="sd">        current_state = self.client.get_state()</span>
<a id="__codelineno-89-58" name="__codelineno-89-58"></a>
<a id="__codelineno-89-59" name="__codelineno-89-59"></a><span class="sd">        ## define loop frequency 1 Hz</span>
<a id="__codelineno-89-60" name="__codelineno-89-60"></a><span class="sd">        r2 = rospy.Rate(1)</span>
<a id="__codelineno-89-61" name="__codelineno-89-61"></a>
<a id="__codelineno-89-62" name="__codelineno-89-62"></a><span class="sd">        # until server status isnt DONE, do something else</span>
<a id="__codelineno-89-63" name="__codelineno-89-63"></a><span class="sd">        while current_state &lt; DONE:</span>
<a id="__codelineno-89-64" name="__codelineno-89-64"></a><span class="sd">            # action is running, so do somethin productive</span>
<a id="__codelineno-89-65" name="__codelineno-89-65"></a>
<a id="__codelineno-89-66" name="__codelineno-89-66"></a><span class="sd">            # check state</span>
<a id="__codelineno-89-67" name="__codelineno-89-67"></a><span class="sd">            current_state = self.client.get_state()</span>
<a id="__codelineno-89-68" name="__codelineno-89-68"></a><span class="sd">            # 1 Hz</span>
<a id="__codelineno-89-69" name="__codelineno-89-69"></a><span class="sd">            r2.sleep()</span>
<a id="__codelineno-89-70" name="__codelineno-89-70"></a>
<a id="__codelineno-89-71" name="__codelineno-89-71"></a><span class="sd">        # is the server state is WARN</span>
<a id="__codelineno-89-72" name="__codelineno-89-72"></a><span class="sd">        if current_state == WARN:</span>
<a id="__codelineno-89-73" name="__codelineno-89-73"></a><span class="sd">            rospy.logwarn(&quot;Warning on the action server side.&quot;)</span>
<a id="__codelineno-89-74" name="__codelineno-89-74"></a>
<a id="__codelineno-89-75" name="__codelineno-89-75"></a><span class="sd">        # if the server state is ERROR</span>
<a id="__codelineno-89-76" name="__codelineno-89-76"></a><span class="sd">        if current_state == ERROR:</span>
<a id="__codelineno-89-77" name="__codelineno-89-77"></a><span class="sd">            rospy.logerr(&quot;Error on the action server side.&quot;)</span>
<a id="__codelineno-89-78" name="__codelineno-89-78"></a><span class="sd">        &#39;&#39;&#39;</span>
<a id="__codelineno-89-79" name="__codelineno-89-79"></a>
<a id="__codelineno-89-80" name="__codelineno-89-80"></a>        <span class="c1"># return result</span>
<a id="__codelineno-89-81" name="__codelineno-89-81"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get_result</span><span class="p">()</span> 
<a id="__codelineno-89-82" name="__codelineno-89-82"></a>
<a id="__codelineno-89-83" name="__codelineno-89-83"></a>
<a id="__codelineno-89-84" name="__codelineno-89-84"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">shutdownhook</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-89-85" name="__codelineno-89-85"></a>        <span class="c1"># works better than the rospy.is_shutdown()</span>
<a id="__codelineno-89-86" name="__codelineno-89-86"></a>        <span class="c1"># this code is run at ctrl + c</span>
<a id="__codelineno-89-87" name="__codelineno-89-87"></a>
<a id="__codelineno-89-88" name="__codelineno-89-88"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl_c</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-89-89" name="__codelineno-89-89"></a>
<a id="__codelineno-89-90" name="__codelineno-89-90"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<a id="__codelineno-89-91" name="__codelineno-89-91"></a>    <span class="c1"># initialise node</span>
<a id="__codelineno-89-92" name="__codelineno-89-92"></a>    <span class="n">rospy</span><span class="o">.</span><span class="n">init_node</span><span class="p">(</span><span class="s1">&#39;run_led_client&#39;</span><span class="p">)</span>
<a id="__codelineno-89-93" name="__codelineno-89-93"></a>    <span class="c1"># initialise class</span>
<a id="__codelineno-89-94" name="__codelineno-89-94"></a>    <span class="n">runled</span> <span class="o">=</span> <span class="n">runled_client</span><span class="p">()</span>
<a id="__codelineno-89-95" name="__codelineno-89-95"></a>
<a id="__codelineno-89-96" name="__codelineno-89-96"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-89-97" name="__codelineno-89-97"></a>        <span class="c1"># poslji goal         </span>
<a id="__codelineno-89-98" name="__codelineno-89-98"></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">runled</span><span class="o">.</span><span class="n">run_led_client</span><span class="p">(</span><span class="n">goalNum</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-89-99" name="__codelineno-89-99"></a>        <span class="c1"># izpisi rezultat</span>
<a id="__codelineno-89-100" name="__codelineno-89-100"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Result: </span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">result</span><span class="o">.</span><span class="n">finalRun</span><span class="p">)</span>
<a id="__codelineno-89-101" name="__codelineno-89-101"></a>    <span class="k">except</span> <span class="n">rospy</span><span class="o">.</span><span class="n">ROSInterruptException</span><span class="p">:</span>
<a id="__codelineno-89-102" name="__codelineno-89-102"></a>        <span class="c1"># v primeru napake</span>
<a id="__codelineno-89-103" name="__codelineno-89-103"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Program interrupted before completion.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h2 id="exercise_4">Exercise</h2>
<p>Stop execution of LEDs sequential blinking if the object is closer that 20 cm.</p>
<h1 id="parameters">Parameters</h1>
<p>Parameter server: globally available dictionary within ROS master</p>
<p>ROS parameter: one variable within the parameter server </p>
<p>Types:</p>
<ul>
<li>Boolean</li>
<li>Int</li>
<li>Double</li>
<li>String</li>
<li>Lists</li>
<li>...</li>
</ul>
<h2 id="example_3">Example</h2>
<p>Code examples:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-90-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-90-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-90-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-90-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-90-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-90-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-90-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-90-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-90-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-90-10">10</a></span>
<span class="normal"><a href="#__codelineno-90-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-90-1" name="__codelineno-90-1"></a><span class="c1"># set parameter</span>
<a id="__codelineno-90-2" name="__codelineno-90-2"></a><span class="n">rospy</span><span class="o">.</span><span class="n">set_param</span><span class="p">(</span><span class="s1">&#39;/publish_frequency&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-90-3" name="__codelineno-90-3"></a>
<a id="__codelineno-90-4" name="__codelineno-90-4"></a><span class="c1"># get parameter</span>
<a id="__codelineno-90-5" name="__codelineno-90-5"></a><span class="n">publish_freq</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s1">&#39;/publish_frequency&#39;</span><span class="p">)</span>
<a id="__codelineno-90-6" name="__codelineno-90-6"></a>
<a id="__codelineno-90-7" name="__codelineno-90-7"></a><span class="c1"># get list of parameters</span>
<a id="__codelineno-90-8" name="__codelineno-90-8"></a><span class="k">try</span><span class="p">:</span>
<a id="__codelineno-90-9" name="__codelineno-90-9"></a>  <span class="n">rospy</span><span class="o">.</span><span class="n">get_param_names</span><span class="p">()</span>
<a id="__codelineno-90-10" name="__codelineno-90-10"></a><span class="k">except</span> <span class="n">ROSException</span><span class="p">:</span>
<a id="__codelineno-90-11" name="__codelineno-90-11"></a>  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Could not get param names&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div></p>
<p>Set parameter in a launch file:
<div class="highlight"><pre><span></span><code><a id="__codelineno-91-1" name="__codelineno-91-1" href="#__codelineno-91-1"></a><span class="nt">&lt;param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;/parameter_name&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;parameter_type&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;value&quot;</span><span class="nt">/&gt;</span>
</code></pre></div></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-92-1">1</a></span>
<span class="normal"><a href="#__codelineno-92-2">2</a></span>
<span class="normal"><a href="#__codelineno-92-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-92-1" name="__codelineno-92-1"></a><span class="nt">&lt;launch&gt;</span>
<a id="__codelineno-92-2" name="__codelineno-92-2"></a><span class="w">  </span><span class="nt">&lt;param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;/publish_frequency&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;int&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;2&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-92-3" name="__codelineno-92-3"></a><span class="nt">&lt;/launch&gt;</span>
</code></pre></div></td></tr></table></div>
<p><code>&lt;rosparam&gt;</code> is used if you want to load a list of parameters from a .yaml file
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-93-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-93-1" name="__codelineno-93-1"></a><span class="nt">&lt;rosparam</span><span class="w"> </span><span class="na">command=</span><span class="s">&quot;load&quot;</span><span class="w"> </span><span class="na">file=</span><span class="s">&quot;$(find &lt;package_name&gt;)/example.yaml&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</code></pre></div></td></tr></table></div></p>
<h2 id="debug_4">DEBUG</h2>
<ul>
<li><code>rosparam set &lt;param name&gt; &lt;value&gt;</code> - to create new parameter</li>
<li><code>rosparam get &lt;param name&gt;</code> - get parameter value</li>
<li><code>rosparam list</code> - get list of parameters</li>
</ul>
<h2 id="exercise_5">Exercise</h2>
<p>Upgrade SimpleActionClient by setting number of runs as parameter <code>/number_of_runs</code>.</p>
<p>Upgrade SimpleActionServer by setting LED frequency as parameter <code>/led_frequency</code>.</p>
<p>Create <code>.launch</code> file for Action Server.</p>
<h1 id="ros-debug-tools">ROS Debug tools</h1>
<h2 id="logging">Logging</h2>
<p>5 logging levels:</p>
<ul>
<li>DEBUG</li>
<li>INFO<ul>
<li>WARN</li>
<li>ERROR<ul>
<li>FATAL</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img alt="Logging levels" src="../images/8_DEBUG.bmp" title="Logging levels" /></p>
<p>Code example
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-94-1">1</a></span>
<span class="normal"><a href="#__codelineno-94-2">2</a></span>
<span class="normal"><a href="#__codelineno-94-3">3</a></span>
<span class="normal"><a href="#__codelineno-94-4">4</a></span>
<span class="normal"><a href="#__codelineno-94-5">5</a></span>
<span class="normal"><a href="#__codelineno-94-6">6</a></span>
<span class="normal"><a href="#__codelineno-94-7">7</a></span>
<span class="normal"><a href="#__codelineno-94-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-94-1" name="__codelineno-94-1"></a><span class="n">rospy</span><span class="o">.</span><span class="n">init_node</span><span class="p">(</span><span class="s1">&#39;log_demo&#39;</span><span class="p">,</span> <span class="n">log_level</span><span class="o">=</span><span class="n">rospy</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
<a id="__codelineno-94-2" name="__codelineno-94-2"></a>
<a id="__codelineno-94-3" name="__codelineno-94-3"></a><span class="k">while</span> <span class="ow">not</span> <span class="n">rospy</span><span class="o">.</span><span class="n">is_shutdown</span><span class="p">():</span>
<a id="__codelineno-94-4" name="__codelineno-94-4"></a>  <span class="n">rospy</span><span class="o">.</span><span class="n">logdebug</span><span class="p">(</span><span class="s2">&quot;Debug msg&quot;</span><span class="p">)</span>
<a id="__codelineno-94-5" name="__codelineno-94-5"></a>  <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s2">&quot;Info msg&quot;</span><span class="p">)</span>
<a id="__codelineno-94-6" name="__codelineno-94-6"></a>  <span class="n">rospy</span><span class="o">.</span><span class="n">logwarn</span><span class="p">(</span><span class="s2">&quot;Warning msg&quot;</span><span class="p">)</span>
<a id="__codelineno-94-7" name="__codelineno-94-7"></a>  <span class="n">rospy</span><span class="o">.</span><span class="n">logerr</span><span class="p">(</span><span class="s2">&quot;Error msg&quot;</span> <span class="p">)</span>
<a id="__codelineno-94-8" name="__codelineno-94-8"></a>  <span class="n">rospy</span><span class="o">.</span><span class="n">logfatal</span><span class="p">(</span><span class="s2">&quot;Fatal msg&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div></p>
<h2 id="rqt_console">rqt_console</h2>
<p>GUI for log messages.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-95-1" name="__codelineno-95-1" href="#__codelineno-95-1"></a>rqt_console
</code></pre></div>
<p><img alt="rqt_console" src="../images/8_rqt_console.bmp" title="rqt_console" /></p>
<h2 id="rqt_plot">rqt_plot</h2>
<p>Graphical plot of signals from selected topics.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-96-1" name="__codelineno-96-1" href="#__codelineno-96-1"></a>rqt_plot
</code></pre></div>
<p><img alt="rqt_plot" src="../images/8_rqt_plot.bmp" title="rqt_plot" /></p>
<h2 id="rqt_graph">rqt_graph</h2>
<p>Shows connection between nodes in the system.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-97-1" name="__codelineno-97-1" href="#__codelineno-97-1"></a>rqt_graph
</code></pre></div>
<p><img alt="rqt_graph" src="../images/8_rqt_graph.bmp" title="rqt_graph" /></p>
<h2 id="rviz">RViz</h2>
<p>RViz visually represents data from topics. </p>
<p>RViz is NOT a simulation, it represents the current state of the robot</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-98-1" name="__codelineno-98-1" href="#__codelineno-98-1"></a>rosrun rviz rviz
</code></pre></div>
<img alt="rviz" src="../images/8_rviz.bmp" title="rviz" /></p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../nodes/" class="btn btn-neutral float-left" title="Node"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../topics/" class="btn btn-neutral float-right" title="Topics">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/sslajpah/ros-docs" class="fa fa-code-fork" style="color: #fcfcfc"> sslajpah/ros-docs</a>
        </span>
    
    
      <span><a href="../nodes/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../topics/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../assets/javascripts/mathjax.js"></script>
      <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
